<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lib/componentBuilder.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: lib/componentBuilder.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 *
 *
 * @class ComponentBuilder
 */
class ComponentBuilder {

    constructor() {
        /*
            InputMedium
        */
        this.options = undefined;

    }
    /**
     *
     *
     * @param options
     * @memberof ComponentBuilder
     */
    setComponentOptions(options) {
        this.options = options;
    }
    /**
     *
     *
     * @return
     * @memberof ComponentBuilder
     */
    build() {
        if (!this.options)
            return {};
        let component = {
            options: {
                cpuMillicores: this.options.cpuMillicores,
                memory: this.options.memory,
                userData: this.options.userData,
                timeContext: this.options.timeContext
            }
        };
        return component;
    }
}
/**
 *
 *
 * @export
 * @class ComponentOptions
 * @param userData
 */
export class ComponentOptions {
    constructor(userData) {
        this.userData = userData;
        this.cpuMillicores = null;
        this.memory = null;
    }
    /**
     *
     *
     * @param val
     * @memberof ComponentOptions
     */
    setUserData(val) {
        this.userData = val;
    }
    /**
     *
     *
     * @param val
     * @memberof ComponentOptions
     */
    setCpu(val) {
        this.cpuMillicores = val;
    }
    /**
     *
     *
     * @param val
     * @memberof ComponentOptions
     */
    setMemory(val) {
        this.memory = val;
    }
}
/**
 *
 *
 * @export
 * @class InputBuilder
 * * @param destination
 */
export class InputBuilder {
    constructor(destination) {
        this.size = 512;
        this.destination = destination;
        this.content = [];
        this.partition_table_type = undefined;
        this.filesystem_type = undefined;
        this.type = undefined;
    }
    /**
     *
     *
     * @param d
     * @memberof InputBuilder
     */
    setDestination(d) {
        this.destination = d;
    }
    /**
     *
     *
     * @param _size
     * @memberof InputBuilder
     */
    setSize(_size) {
        this.size = _size;
    }

    /**
     *
     *
     * @param c
     * @memberof InputBuilder
     */
    addContent(c) {
        this.content.push(c);
    }
    /**
     *
     *
     * @return
     * @memberof InputBuilder
     */
    build() {
        let input_data = {};
        input_data.size_mb = this.size;
        input_data.destination = this.destination;
        input_data.partition_table_type = this.partition_table_type;
        input_data.filesystem_type = this.filesystem_type;
        input_data.type = this.type;
        input_data.content = this.content;

        input_data.content = [];
        
        this.content.forEach(element => {
            input_data.content.push(element.build());
        });
        
        return input_data;
    }
}

/**
 *
 *
 * @export
 * @class InputContentBuilder
 * @param url
 */
export class InputContentBuilder {
    constructor(url) {
        this.action = "copy";
        this.url = url;
        this.compression_format = "tar";
        this.name = undefined; 
    }
    /**
     *
     *
     * @param _url
     * @memberof InputContentBuilder
     */
    setUrl(_url) {
        this.url = _url;
    }
    /**
     *
     *
     * @param _name
     * @memberof InputContentBuilder
     */
    setName(_name) {
        this.name = _name;
    }
    /**
     *
     *
     * @param _action
     * @memberof InputContentBuilder
     */
    setAction(_action) {
        this.action = _action;
    }
    /**
     *
     *
     * @param _cFmt
     * @memberof InputContentBuilder
     */
    setCompressionFmt(_cFmt) {
        this.compression_format = _cFmt;
    }
    /**
     *
     *
     * @return
     * @memberof InputContentBuilder
     */
    build() {
        let content = {};

        content.action = this.action;
        content.url = this.url;
        content.compression_format = this.compression_format;
        content.name = this.name;

        return content;
    }
}
/**
 *
 *
 * @export
 * @class MachineComponentBuilder
 * @extends {ComponentBuilder}
 * @param environmentId
 * @param [imageArchive=null]
 */
export class MachineComponentBuilder extends ComponentBuilder {

    constructor(environmentId, imageArchive = null) {
        super();

        this.type = "machine";

        // possible machine component config fields

        // required;
        this.environment = environmentId;

        this.userMedia = undefined;
        this.input_data = [];

        // optional
        this.archive = imageArchive;
        this.inputs = [];

        this.object = undefined;
        this.objectArchive = undefined;

        this.software = undefined;

        // boolean
        this._lockEnvironment = undefined;
        this.emulatorVersion = undefined;
        this.nic = undefined;
        this.linuxRuntimeData = undefined;

        this.keyboardLayout = undefined;
        this.keyboardModel = undefined;

        // ui only settings
        this.interactive = false;
        this.isHeadless = false;

        // for internal use, if network is configure
        this.networkSettings = null;
    }

    /**
     *
     *
     * @param url
     * @param mediumType
     * @memberof MachineComponentBuilder
     */
    addUserMedia(url, mediumType) {
        if (!this.userMedia)
            this.userMedia = [];

        this.userMedia.push({
            url: url,
            mediumType: mediumType
        });
    }
    /**
     *
     *
     * @return
     * @memberof MachineComponentBuilder
     */
    getNetworkConfig() {
        return this.networkSettings;
    }
    /**
     *
     *
     * @param val
     * @memberof MachineComponentBuilder
     */
    setNetworkConfig(val) {
        this.networkSettings = val;
        if(val &amp;&amp; val.hwAddress != "auto")
            this.nic = val.hwAddress;
    }
    /**
     *
     *
     * @return
     * @memberof MachineComponentBuilder
     */
    getId() {
        return this.environment;
    }
    /**
     *
     *
     * @param val
     * @memberof MachineComponentBuilder
     */
    setInteractive(val) {
        this.interactive = val;
    }
    /**
     *
     *
     * @return
     * @memberof MachineComponentBuilder
     */
    isInteractive() {
        return this.interactive;
    }
    /**
     *
     *
     * @param archive
     * @memberof MachineComponentBuilder
     */
    setImageArchive(archive) {
        this.archive = archive;
    }
    /**
     *
     *
     * @param inputMedia
     * @memberof MachineComponentBuilder
     */
    addInputMedia(inputMedia) {
        this.input_data.push(inputMedia);
    }
    /**
     *
     *
     * @param objectId
     * @param objectArchive
     * @memberof MachineComponentBuilder
     */
    setObject(objectId, objectArchive) {
        this.object = objectId;
        this.objectArchive = objectArchive;
    }
    /**
     *
     *
     * @param val
     * @memberof MachineComponentBuilder
     */
    setSoftware(software, objectArchive) {
        this.software = software;
        this.objectArchive = objectArchive;
    }
    /**
     *
     *
     * @param {boolean} [doLock=true]
     * @memberof MachineComponentBuilder
     */
    lockEnvironment(doLock = true) {
        this.lockEnvironment = doLock;
    }
    /**
     *
     *
     * @param emulatorVersion
     * @memberof MachineComponentBuilder
     */
    setEmulatorVersion(emulatorVersion) {
        this.emulatorVersion = emulatorVersion;
    }
    /**
     *
     *
     * @param mac
     * @memberof MachineComponentBuilder
     */
    setEthernetAddress(mac) {
        this.nic = mac;
    }
    /**
     *
     *
     * @param r
     * @memberof MachineComponentBuilder
     */
    setRuntime(r) {
        this.linuxRuntimeData = r.build();
    }

    setImageModificationList(l)
    {
        this.imageModificationRequestList = l;
    }
    
    /**
     *
     *
     * @param runtime
     * @return
     * @memberof MachineComponentBuilder
     */
    setLinuxRuntime(runtime) {
        if (!runtime)
            return;

        this.linuxRuntimeData = {
            userContainerEnvironment: runtime.userContainerEnvironment,
            userContainerArchive: runtime.userContainerArchive,
            isMountUserShare: runtime.isMountUserShare,
            userEnvironment: runtime.userEnvironment,
            isDHCPenabled: (runtime.networking||{}).isDHCPenabled, 
            isTelnetEnabled: (runtime.networking||{}).isTelnetEnabled,
        };
       
        this.inputs = runtime.input_data;
    }
    /**
     *
     *
     * @param layout
     * @param model
     * @memberof MachineComponentBuilder
     */
    setKeyboard(layout, model) {
        this.keyboardLayout = layout;
        this.model = model;
    }

    /**
     *
     * @memberof MachineComponentBuilder
     *
     * 
     */
    setHeadless(b) {
        this.isHeadless = b;
    }

    /**
     *
     *
     * @return
     * @memberof MachineComponentBuilder
     */
    build() {
        if (!this.environment)
            throw new Error("Cannot create component request, environmentId is required.");

        let component = {
            type: this.type,
            environment: this.environment,
            userMedia: this.userMedia,
            archive: this.archive ? this.archive : "default",
            object: this.object,
            objectArchive: this.objectArchive,
            software: this.software,
            lockEnvironment: this._lockEnvironment,
            emulatorVersion: this.emulatorVersion,
            nic: this.nic,
            linuxRuntimeData: this.linuxRuntimeData,
            keyboardLayout: this.keyboardLayout,
            keyboardModel: this.keyboardModel,
            headless: this.isHeadless,
            imageModificationRequestList: this.imageModificationRequestList
        };
    
        if (this.input_data.length) {
            component.input_data = [];
            this.input_data.forEach(element => {
                component.input_data.push(element.build());
            });
        } else
            component.input_data = this.inputs;
        
        return Object.assign(component, super.build());
    }

    /*
    

    static async startContainer(api, containerRequest, idToken)
    {
        var data = {};
        data.type = "container";
        data.environment = containerId;
        data.input_data = args.input_data;

        console.log("Starting container " + containerId + "...");
        var deferred = $.Deferred();

        $.ajax({
            type: "POST",
            url: this.API_URL + "/components",
            data: JSON.stringify(data),
            contentType: "application/json",
            headers: localStorage.getItem('id_token') ? { "Authorization": "Bearer " + localStorage.getItem('id_token') } : {}
        }).then((data, status, xhr) => {
            console.log("container " + containerId + " started.");
            this.componentId = data.id;
            this.isStarted = true;
            this.pollStateIntervalId = setInterval(() => { this._pollState(); }, 1500);
            deferred.resolve();
        },
            (xhr) => {
                this._onFatalError($.parseJSON(xhr.responseText));
                deferred.reject();
            });
        return deferred.promise();
    }
    */
}
/**
 *
 *
 * @export
 * @class ContainerRuntimeBuilder
 * @param envId
 * @param {string} [archive="default"]
 */
export class ContainerRuntimeBuilder {

    constructor(envId, archive = "default") {
        this.environmentId = envId;
        this.archive = archive;
        this.isDHCPenabled = false;
        this.isTelnetEnabled = false;
        this.isMountUserShare = false;
        this.userEnvironment = [];
        this.input = [];
    }
    /**
     *
     *
     * @param {boolean} [b=true]
     * @memberof ContainerRuntimeBuilder
     */
    enableDhcp(b = true) {
        this.isDHCPenabled = b;
    }
    /**
     *
     *
     * @param {boolean} [b=true]
     * @memberof ContainerRuntimeBuilder
     */
    enableTelnet(b = true) {
        this.isTelnetEnabled = b;
    }
    /**
     *
     *
     * @param {boolean} [b=true]
     * @memberof ContainerRuntimeBuilder
     */
    mountUserShare(b = true) {
        this.isMountUserShare = b;
    }
    /**
     *
     *
     * @param env
     * @memberof ContainerRuntimeBuilder
     */
    addUserEnvironment(env) {
        this.userEnvironment.push(env);
    }
    /**
     *
     *
     * @return
     * @memberof ContainerRuntimeBuilder
     */
    build() {
        let linuxRuntimeData = {
            userContainerEnvironment: this.environmentId,
            userContainerArchive: this.archive,
            isDHCPenabled: this.isDHCPenabled,
            isTelnetEnabled: this.isTelnetEnabled,
            userEnvironment: this.userEnvironment,
            mountUserShare: this.isMountUserShare
        };
        return linuxRuntimeData;
    }
}
/**
 *
 *
 * @export
 * @class UviMachineComponentBuilder
 * @extends {MachineComponentBuilder}
 * @param uvi
 * @param environmentId
 * @param [imageArchive=null]
 */
export class UviMachineComponentBuilder extends MachineComponentBuilder {

    constructor(uvi, environmentId, imageArchive = null) {
        super(environmentId, imageArchive);
        this.type = "uvi";

        this.uviUrl = uvi.url;
        this.uviFilename = uvi.filename;
        this.uviWriteable = uvi.writeable;
        this.auxFiles = uvi.auxFiles;
    }
    /**
     *
     *
     * @return
     * @memberof UviMachineComponentBuilder
     */
    build() {
        let component = {
            uviUrl: this.uviUrl,
            uviFilename: this.uviFilename,
            uviWriteable: this.uviWriteable,
            auxFiles: this.auxFiles
        };

        return Object.assign(component, super.build());
    }
}

export class ImageModificationRequest{

    constructor() {
        this.action = null;
        this.condition = null;
        this.dataUrl = null;
        this.destination = null;
    }

    /**
     *
     * @param action 'extract_tar' or 'copy' 
     * 
     * @memberof ImageModificationRequest
     */
    setAction(action)
    {
        this.action = action;
    }

    /**
     *
     * @param condition 
     * @see ImageModificationCondition
     * 
     * @memberof ImageModificationRequest
     */
    setCondition(condition) {
        this.condition = condition;
    }

    /**
     *
     * @param dataUrl String  
     * 
     * @memberof ImageModificationRequest
     */
    setDataUrl(dataUrl) {
        this.dataUrl = dataUrl;
    }

    /**
     *
     * @param destination String  
     * 
     * @memberof ImageModificationRequest
     */
    setDestination(destination) {
        this.destination = destination;
    }
}

export class ImageModificationCondition {
    constructor () {
        this.partitionName = null;
        this.fsType = null;
        this.paths = [];
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a></li><li><a href="ClientError.html">ClientError</a></li><li><a href="ClientOptions.html">ClientOptions</a></li><li><a href="ComponentBuilder.html">ComponentBuilder</a></li><li><a href="ComponentOptions.html">ComponentOptions</a></li><li><a href="ComponentSession.html">ComponentSession</a></li><li><a href="ContainerBuilder.html">ContainerBuilder</a></li><li><a href="ContainerImageBuilder.html">ContainerImageBuilder</a></li><li><a href="ContainerRuntimeBuilder.html">ContainerRuntimeBuilder</a></li><li><a href="EmulatorBuilder.html">EmulatorBuilder</a></li><li><a href="InputBuilder.html">InputBuilder</a></li><li><a href="InputContentBuilder.html">InputContentBuilder</a></li><li><a href="MachineComponentBuilder.html">MachineComponentBuilder</a></li><li><a href="NetworkBuilder.html">NetworkBuilder</a></li><li><a href="NetworkComponentConfig.html">NetworkComponentConfig</a></li><li><a href="NetworkConfig.html">NetworkConfig</a></li><li><a href="NetworkSession.html">NetworkSession</a></li><li><a href="SaveImportRequest.html">SaveImportRequest</a></li><li><a href="SaveNewEnvironmentRequest.html">SaveNewEnvironmentRequest</a></li><li><a href="SaveObjectEnvironmentRequest.html">SaveObjectEnvironmentRequest</a></li><li><a href="SaveRevisionRequest.html">SaveRevisionRequest</a></li><li><a href="SaveUserSessionRequest.html">SaveUserSessionRequest</a></li><li><a href="TcpGatewayConfig.html">TcpGatewayConfig</a></li><li><a href="TransformStream.html">TransformStream</a></li><li><a href="UviMachineComponentBuilder.html">UviMachineComponentBuilder</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_fetch">_fetch</a></li><li><a href="global.html#assignRandomMac">assignRandomMac</a></li><li><a href="global.html#BwflaMouse">BwflaMouse</a></li><li><a href="global.html#hideClientCursor">hideClientCursor</a></li><li><a href="global.html#onmousedown">onmousedown</a></li><li><a href="global.html#onmousemove">onmousemove</a></li><li><a href="global.html#onmouseup">onmouseup</a></li><li><a href="global.html#requestPointerLock">requestPointerLock</a></li><li><a href="global.html#sendAltTab">sendAltTab</a></li><li><a href="global.html#sendEsc">sendEsc</a></li><li><a href="global.html#showClientCursor">showClientCursor</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Fri Oct 08 2021 14:23:23 GMT+0200 (Mitteleuropäische Sommerzeit)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
