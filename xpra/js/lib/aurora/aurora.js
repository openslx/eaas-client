!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AV=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(){var Asset,BufferSource,Decoder,Demuxer,EventEmitter,FileSource,HTTPSource,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events"),HTTPSource=require("./sources/node/http"),FileSource=require("./sources/node/file"),BufferSource=require("./sources/buffer"),Demuxer=require("./demuxer"),Decoder=require("./decoder"),Asset=function(superClass){function Asset(source){this.source=source,this._decode=bind(this._decode,this),this.findDecoder=bind(this.findDecoder,this),this.probe=bind(this.probe,this),this.buffered=0,this.duration=null,this.format=null,this.metadata=null,this.active=!1,this.demuxer=null,this.decoder=null,this.source.once("data",this.probe),this.source.on("error",function(_this){return function(err){return _this.emit("error",err),_this.stop()}}(this)),this.source.on("progress",function(_this){return function(buffered){return _this.buffered=buffered,_this.emit("buffer",_this.buffered)}}(this))}return extend(Asset,superClass),Asset.fromURL=function(url,opts){return new Asset(new HTTPSource(url,opts))},Asset.fromFile=function(file){return new Asset(new FileSource(file))},Asset.fromBuffer=function(buffer){return new Asset(new BufferSource(buffer))},Asset.prototype.start=function(decode){if(!this.active)return null!=decode&&(this.shouldDecode=decode),null==this.shouldDecode&&(this.shouldDecode=!0),this.active=!0,this.source.start(),this.decoder&&this.shouldDecode?this._decode():void 0},Asset.prototype.stop=function(){if(this.active)return this.active=!1,this.source.pause()},Asset.prototype.get=function(event,callback){if("format"===event||"duration"===event||"metadata"===event)return null!=this[event]?callback(this[event]):(this.once(event,function(_this){return function(value){return _this.stop(),callback(value)}}(this)),this.start())},Asset.prototype.decodePacket=function(){return this.decoder.decode()},Asset.prototype.decodeToBuffer=function(callback){var chunks,dataHandler,length;return length=0,chunks=[],this.on("data",dataHandler=function(chunk){return length+=chunk.length,chunks.push(chunk)}),this.once("end",function(){var buf,chunk,j,len,offset;for(buf=new Float32Array(length),offset=0,j=0,len=chunks.length;j<len;j++)chunk=chunks[j],buf.set(chunk,offset),offset+=chunk.length;return this.off("data",dataHandler),callback(buf)}),this.start()},Asset.prototype.probe=function(chunk){var demuxer;if(this.active)return(demuxer=Demuxer.find(chunk))?(this.demuxer=new demuxer(this.source,chunk),this.demuxer.on("format",this.findDecoder),this.demuxer.on("duration",function(_this){return function(duration){return _this.duration=duration,_this.emit("duration",_this.duration)}}(this)),this.demuxer.on("metadata",function(_this){return function(metadata){return _this.metadata=metadata,_this.emit("metadata",_this.metadata)}}(this)),this.demuxer.on("error",function(_this){return function(err){return _this.emit("error",err),_this.stop()}}(this))):this.emit("error","A demuxer for this container was not found.")},Asset.prototype.findDecoder=function(format){var decoder,div;if(this.format=format,this.active)return this.emit("format",this.format),(decoder=Decoder.find(this.format.formatID))?(this.decoder=new decoder(this.demuxer,this.format),this.format.floatingPoint?this.decoder.on("data",function(_this){return function(buffer){return _this.emit("data",buffer)}}(this)):(div=Math.pow(2,this.format.bitsPerChannel-1),this.decoder.on("data",function(_this){return function(buffer){var buf,i,j,len,sample;for(buf=new Float32Array(buffer.length),i=j=0,len=buffer.length;j<len;i=++j)sample=buffer[i],buf[i]=sample/div;return _this.emit("data",buf)}}(this))),this.decoder.on("error",function(_this){return function(err){return _this.emit("error",err),_this.stop()}}(this)),this.decoder.on("end",function(_this){return function(){return _this.emit("end")}}(this)),this.emit("decodeStart"),this.shouldDecode?this._decode():void 0):this.emit("error","A decoder for "+this.format.formatID+" was not found.")},Asset.prototype._decode=function(){for(;this.decoder.decode()&&this.active;);if(this.active)return this.decoder.once("data",this._decode)},Asset.prototype.destroy=function(){var ref,ref1,ref2;return this.stop(),null!=(ref=this.demuxer)&&ref.off(),null!=(ref1=this.decoder)&&ref1.off(),null!=(ref2=this.source)&&ref2.off(),this.off()},Asset}(EventEmitter),module.exports=Asset}).call(this)},{"./core/events":8,"./decoder":11,"./demuxer":14,"./sources/buffer":31,"./sources/node/file":29,"./sources/node/http":30}],2:[function(require,module,exports){(function(){var key,ref,val;ref=require("./aurora_base");for(key in ref)val=ref[key],exports[key]=val;require("./demuxers/caf"),require("./demuxers/m4a"),require("./demuxers/aiff"),require("./demuxers/wave"),require("./demuxers/au"),require("./decoders/lpcm"),require("./decoders/xlaw")}).call(this)},{"./aurora_base":3,"./decoders/lpcm":12,"./decoders/xlaw":13,"./demuxers/aiff":15,"./demuxers/au":16,"./demuxers/caf":17,"./demuxers/m4a":18,"./demuxers/wave":19}],3:[function(require,module,exports){(function(){exports.Base=require("./core/base"),exports.Buffer=require("./core/buffer"),exports.BufferList=require("./core/bufferlist"),exports.Stream=require("./core/stream"),exports.Bitstream=require("./core/bitstream"),exports.EventEmitter=require("./core/events"),exports.UnderflowError=require("./core/underflow"),exports.HTTPSource=require("./sources/node/http"),exports.FileSource=require("./sources/node/file"),exports.BufferSource=require("./sources/buffer"),exports.Demuxer=require("./demuxer"),exports.Decoder=require("./decoder"),exports.AudioDevice=require("./device"),exports.Asset=require("./asset"),exports.Player=require("./player"),exports.Filter=require("./filter"),exports.VolumeFilter=require("./filters/volume"),exports.BalanceFilter=require("./filters/balance")}).call(this)},{"./asset":1,"./core/base":4,"./core/bitstream":5,"./core/buffer":6,"./core/bufferlist":7,"./core/events":8,"./core/stream":9,"./core/underflow":10,"./decoder":11,"./demuxer":14,"./device":20,"./filter":24,"./filters/balance":25,"./filters/volume":26,"./player":27,"./sources/buffer":31,"./sources/node/file":29,"./sources/node/http":30}],4:[function(require,module,exports){(function(){var Base,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Base=function(){function Base(){}var fnTest;return fnTest=/\b_super\b/,Base.extend=function(prop){var Class,_super,fn,key,keys,ref;if(Class=function(superClass){function Class(){return Class.__super__.constructor.apply(this,arguments)}return extend(Class,superClass),Class}(this),"function"==typeof prop){keys=Object.keys(Class.prototype),prop.call(Class,Class),prop={},ref=Class.prototype;for(key in ref)fn=ref[key],indexOf.call(keys,key)<0&&(prop[key]=fn)}_super=Class.__super__;for(key in prop)fn=prop[key],"function"==typeof fn&&fnTest.test(fn)?function(key,fn){Class.prototype[key]=function(){var ret,tmp;return tmp=this._super,this._super=_super[key],ret=fn.apply(this,arguments),this._super=tmp,ret}}(key,fn):Class.prototype[key]=fn;return Class},Base}(),module.exports=Base}).call(this)},{}],5:[function(require,module,exports){(function(){var Bitstream;Bitstream=function(){function Bitstream(stream){this.stream=stream,this.bitPosition=0}return Bitstream.prototype.copy=function(){var result;return result=new Bitstream(this.stream.copy()),result.bitPosition=this.bitPosition,result},Bitstream.prototype.offset=function(){return 8*this.stream.offset+this.bitPosition},Bitstream.prototype.available=function(bits){return this.stream.available((bits+8-this.bitPosition)/8)},Bitstream.prototype.advance=function(bits){var pos;return pos=this.bitPosition+bits,this.stream.advance(pos>>3),this.bitPosition=7&pos},Bitstream.prototype.rewind=function(bits){var pos;return pos=this.bitPosition-bits,this.stream.rewind(Math.abs(pos>>3)),this.bitPosition=7&pos},Bitstream.prototype.seek=function(offset){var curOffset;return curOffset=this.offset(),offset>curOffset?this.advance(offset-curOffset):offset<curOffset?this.rewind(curOffset-offset):void 0},Bitstream.prototype.align=function(){if(0!==this.bitPosition)return this.bitPosition=0,this.stream.advance(1)},Bitstream.prototype.read=function(bits,signed){var a,a0,a1,a2,a3,a4,mBits;if(0===bits)return 0;if((mBits=bits+this.bitPosition)<=8)a=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-bits;else if(mBits<=16)a=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-bits;else if(mBits<=24)a=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-bits;else if(mBits<=32)a=this.stream.peekUInt32()<<this.bitPosition>>>32-bits;else{if(!(mBits<=40))throw new Error("Too many bits!");a0=4294967296*this.stream.peekUInt8(0),a1=this.stream.peekUInt8(1)<<24>>>0,a2=this.stream.peekUInt8(2)<<16,a3=this.stream.peekUInt8(3)<<8,a4=this.stream.peekUInt8(4),a=a0+a1+a2+a3+a4,a%=Math.pow(2,40-this.bitPosition),a=Math.floor(a/Math.pow(2,40-this.bitPosition-bits))}return signed&&(mBits<32?a>>>bits-1&&(a=-1*((1<<bits>>>0)-a)):a/Math.pow(2,bits-1)|0&&(a=-1*(Math.pow(2,bits)-a))),this.advance(bits),a},Bitstream.prototype.peek=function(bits,signed){var a,a0,a1,a2,a3,a4,mBits;if(0===bits)return 0;if((mBits=bits+this.bitPosition)<=8)a=(this.stream.peekUInt8()<<this.bitPosition&255)>>>8-bits;else if(mBits<=16)a=(this.stream.peekUInt16()<<this.bitPosition&65535)>>>16-bits;else if(mBits<=24)a=(this.stream.peekUInt24()<<this.bitPosition&16777215)>>>24-bits;else if(mBits<=32)a=this.stream.peekUInt32()<<this.bitPosition>>>32-bits;else{if(!(mBits<=40))throw new Error("Too many bits!");a0=4294967296*this.stream.peekUInt8(0),a1=this.stream.peekUInt8(1)<<24>>>0,a2=this.stream.peekUInt8(2)<<16,a3=this.stream.peekUInt8(3)<<8,a4=this.stream.peekUInt8(4),a=a0+a1+a2+a3+a4,a%=Math.pow(2,40-this.bitPosition),a=Math.floor(a/Math.pow(2,40-this.bitPosition-bits))}return signed&&(mBits<32?a>>>bits-1&&(a=-1*((1<<bits>>>0)-a)):a/Math.pow(2,bits-1)|0&&(a=-1*(Math.pow(2,bits)-a))),a},Bitstream.prototype.readLSB=function(bits,signed){var a,mBits;if(0===bits)return 0;if(bits>40)throw new Error("Too many bits!");return mBits=bits+this.bitPosition,a=this.stream.peekUInt8(0)>>>this.bitPosition,mBits>8&&(a|=this.stream.peekUInt8(1)<<8-this.bitPosition),mBits>16&&(a|=this.stream.peekUInt8(2)<<16-this.bitPosition),mBits>24&&(a+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0),mBits>32&&(a+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)),mBits>=32?a%=Math.pow(2,bits):a&=(1<<bits)-1,signed&&(mBits<32?a>>>bits-1&&(a=-1*((1<<bits>>>0)-a)):a/Math.pow(2,bits-1)|0&&(a=-1*(Math.pow(2,bits)-a))),this.advance(bits),a},Bitstream.prototype.peekLSB=function(bits,signed){var a,mBits;if(0===bits)return 0;if(bits>40)throw new Error("Too many bits!");return mBits=bits+this.bitPosition,a=this.stream.peekUInt8(0)>>>this.bitPosition,mBits>8&&(a|=this.stream.peekUInt8(1)<<8-this.bitPosition),mBits>16&&(a|=this.stream.peekUInt8(2)<<16-this.bitPosition),mBits>24&&(a+=this.stream.peekUInt8(3)<<24-this.bitPosition>>>0),mBits>32&&(a+=this.stream.peekUInt8(4)*Math.pow(2,32-this.bitPosition)),mBits>=32?a%=Math.pow(2,bits):a&=(1<<bits)-1,signed&&(mBits<32?a>>>bits-1&&(a=-1*((1<<bits>>>0)-a)):a/Math.pow(2,bits-1)|0&&(a=-1*(Math.pow(2,bits)-a))),a},Bitstream}(),module.exports=Bitstream}).call(this)},{}],6:[function(require,module,exports){(function(global){(function(){var AVBuffer;AVBuffer=function(){function AVBuffer(input){var ref;if(input instanceof Uint8Array)this.data=input;else if(input instanceof ArrayBuffer||Array.isArray(input)||"number"==typeof input||(null!=(ref=global.Buffer)?ref.isBuffer(input):void 0))this.data=new Uint8Array(input);else if(input.buffer instanceof ArrayBuffer)this.data=new Uint8Array(input.buffer,input.byteOffset,input.length*input.BYTES_PER_ELEMENT);else{if(!(input instanceof AVBuffer))throw new Error("Constructing buffer with unknown type.");this.data=input.data}this.length=this.data.length,this.next=null,this.prev=null}var BlobBuilder,URL;return AVBuffer.allocate=function(size){return new AVBuffer(size)},AVBuffer.prototype.copy=function(){return new AVBuffer(new Uint8Array(this.data))},AVBuffer.prototype.slice=function(position,length){return null==length&&(length=this.length),new AVBuffer(0===position&&length>=this.length?this.data:this.data.subarray(position,position+length))},BlobBuilder=global.BlobBuilder||global.MozBlobBuilder||global.WebKitBlobBuilder,URL=global.URL||global.webkitURL||global.mozURL,AVBuffer.makeBlob=function(data,type){var bb;null==type&&(type="application/octet-stream");try{return new Blob([data],{type:type})}catch(error){}return null!=BlobBuilder?(bb=new BlobBuilder,bb.append(data),bb.getBlob(type)):null},AVBuffer.makeBlobURL=function(data,type){return null!=URL?URL.createObjectURL(this.makeBlob(data,type)):void 0},AVBuffer.revokeBlobURL=function(url){return null!=URL?URL.revokeObjectURL(url):void 0},AVBuffer.prototype.toBlob=function(){return AVBuffer.makeBlob(this.data.buffer)},AVBuffer.prototype.toBlobURL=function(){return AVBuffer.makeBlobURL(this.data.buffer)},AVBuffer}(),module.exports=AVBuffer}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],7:[function(require,module,exports){(function(){var BufferList;BufferList=function(){function BufferList(){this.first=null,this.last=null,this.numBuffers=0,this.availableBytes=0,this.availableBuffers=0}return BufferList.prototype.copy=function(){var result;return result=new BufferList,result.first=this.first,result.last=this.last,result.numBuffers=this.numBuffers,result.availableBytes=this.availableBytes,result.availableBuffers=this.availableBuffers,result},BufferList.prototype.append=function(buffer){var ref;return buffer.prev=this.last,null!=(ref=this.last)&&(ref.next=buffer),this.last=buffer,null==this.first&&(this.first=buffer),this.availableBytes+=buffer.length,this.availableBuffers++,this.numBuffers++},BufferList.prototype.advance=function(){return!!this.first&&(this.availableBytes-=this.first.length,this.availableBuffers--,this.first=this.first.next,null!=this.first)},BufferList.prototype.rewind=function(){var ref;return!(this.first&&!this.first.prev)&&(this.first=(null!=(ref=this.first)?ref.prev:void 0)||this.last,this.first&&(this.availableBytes+=this.first.length,this.availableBuffers++),null!=this.first)},BufferList.prototype.reset=function(){var results;for(results=[];this.rewind(););return results},BufferList}(),module.exports=BufferList}).call(this)},{}],8:[function(require,module,exports){(function(){var Base,EventEmitter,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;Base=require("./base"),EventEmitter=function(superClass){function EventEmitter(){return EventEmitter.__super__.constructor.apply(this,arguments)}return extend(EventEmitter,superClass),EventEmitter.prototype.on=function(event,fn){var base;return null==this.events&&(this.events={}),null==(base=this.events)[event]&&(base[event]=[]),this.events[event].push(fn)},EventEmitter.prototype.off=function(event,fn){var index,ref;if(null!=this.events)if(null!=(ref=this.events)?ref[event]:void 0){if(null==fn)return this.events[event];if(~(index=this.events[event].indexOf(fn)))return this.events[event].splice(index,1)}else if(null==event)return{}},EventEmitter.prototype.once=function(event,fn){var cb;return this.on(event,cb=function(){return this.off(event,cb),fn.apply(this,arguments)})},EventEmitter.prototype.emit=function(){var args,event,fn,i,len,ref,ref1;if(event=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],null!=(ref=this.events)?ref[event]:void 0)for(ref1=this.events[event].slice(),i=0,len=ref1.length;i<len;i++)fn=ref1[i],fn.apply(this,args)},EventEmitter}(Base),module.exports=EventEmitter}).call(this)},{"./base":4}],9:[function(require,module,exports){(function(){var AVBuffer,BufferList,Stream,UnderflowError;BufferList=require("./bufferlist"),AVBuffer=require("./buffer"),UnderflowError=require("./underflow"),Stream=function(){function Stream(list1){this.list=list1,this.localOffset=0,this.offset=0}var buf,decodeString,float32,float64,float64Fallback,float80,int16,int32,int8,nativeEndian,uint16,uint32,uint8;return buf=new ArrayBuffer(16),uint8=new Uint8Array(buf),int8=new Int8Array(buf),uint16=new Uint16Array(buf),int16=new Int16Array(buf),uint32=new Uint32Array(buf),int32=new Int32Array(buf),float32=new Float32Array(buf),"undefined"!=typeof Float64Array&&null!==Float64Array&&(float64=new Float64Array(buf)),nativeEndian=13330===new Uint16Array(new Uint8Array([18,52]).buffer)[0],Stream.fromBuffer=function(buffer){var list;return list=new BufferList,list.append(buffer),new Stream(list)},Stream.prototype.copy=function(){var result;return result=new Stream(this.list.copy()),result.localOffset=this.localOffset,result.offset=this.offset,result},Stream.prototype.available=function(bytes){return bytes<=this.list.availableBytes-this.localOffset},Stream.prototype.remainingBytes=function(){return this.list.availableBytes-this.localOffset},Stream.prototype.advance=function(bytes){if(!this.available(bytes))throw new UnderflowError;for(this.localOffset+=bytes,this.offset+=bytes;this.list.first&&this.localOffset>=this.list.first.length;)this.localOffset-=this.list.first.length,this.list.advance();return this},Stream.prototype.rewind=function(bytes){if(bytes>this.offset)throw new UnderflowError;for(this.list.first||(this.list.rewind(),this.localOffset=this.list.first.length),this.localOffset-=bytes,this.offset-=bytes;this.list.first.prev&&this.localOffset<0;)this.list.rewind(),this.localOffset+=this.list.first.length;return this},Stream.prototype.seek=function(position){return position>this.offset?this.advance(position-this.offset):position<this.offset?this.rewind(this.offset-position):void 0},Stream.prototype.readUInt8=function(){var a;if(!this.available(1))throw new UnderflowError;return a=this.list.first.data[this.localOffset],this.localOffset+=1,this.offset+=1,this.localOffset===this.list.first.length&&(this.localOffset=0,this.list.advance()),a},Stream.prototype.peekUInt8=function(offset){var buffer;if(null==offset&&(offset=0),!this.available(offset+1))throw new UnderflowError;for(offset=this.localOffset+offset,buffer=this.list.first;buffer;){if(buffer.length>offset)return buffer.data[offset];offset-=buffer.length,buffer=buffer.next}return 0},Stream.prototype.read=function(bytes,littleEndian){var i,j,k,ref;if(null==littleEndian&&(littleEndian=!1),littleEndian===nativeEndian)for(i=j=0,ref=bytes;j<ref;i=j+=1)uint8[i]=this.readUInt8();else for(i=k=bytes-1;k>=0;i=k+=-1)uint8[i]=this.readUInt8()},Stream.prototype.peek=function(bytes,offset,littleEndian){var i,j,k,ref,ref1;if(null==littleEndian&&(littleEndian=!1),littleEndian===nativeEndian)for(i=j=0,ref=bytes;j<ref;i=j+=1)uint8[i]=this.peekUInt8(offset+i);else for(i=k=0,ref1=bytes;k<ref1;i=k+=1)uint8[bytes-i-1]=this.peekUInt8(offset+i)},Stream.prototype.readInt8=function(){return this.read(1),int8[0]},Stream.prototype.peekInt8=function(offset){return null==offset&&(offset=0),this.peek(1,offset),int8[0]},Stream.prototype.readUInt16=function(littleEndian){return this.read(2,littleEndian),uint16[0]},Stream.prototype.peekUInt16=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(2,offset,littleEndian),uint16[0]},Stream.prototype.readInt16=function(littleEndian){return this.read(2,littleEndian),int16[0]},Stream.prototype.peekInt16=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(2,offset,littleEndian),int16[0]},Stream.prototype.readUInt24=function(littleEndian){return littleEndian?this.readUInt16(!0)+(this.readUInt8()<<16):(this.readUInt16()<<8)+this.readUInt8()},Stream.prototype.peekUInt24=function(offset,littleEndian){return null==offset&&(offset=0),littleEndian?this.peekUInt16(offset,!0)+(this.peekUInt8(offset+2)<<16):(this.peekUInt16(offset)<<8)+this.peekUInt8(offset+2)},Stream.prototype.readInt24=function(littleEndian){return littleEndian?this.readUInt16(!0)+(this.readInt8()<<16):(this.readInt16()<<8)+this.readUInt8()},Stream.prototype.peekInt24=function(offset,littleEndian){return null==offset&&(offset=0),littleEndian?this.peekUInt16(offset,!0)+(this.peekInt8(offset+2)<<16):(this.peekInt16(offset)<<8)+this.peekUInt8(offset+2)},Stream.prototype.readUInt32=function(littleEndian){return this.read(4,littleEndian),uint32[0]},Stream.prototype.peekUInt32=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(4,offset,littleEndian),uint32[0]},Stream.prototype.readInt32=function(littleEndian){return this.read(4,littleEndian),int32[0]},Stream.prototype.peekInt32=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(4,offset,littleEndian),int32[0]},Stream.prototype.readFloat32=function(littleEndian){return this.read(4,littleEndian),float32[0]},Stream.prototype.peekFloat32=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(4,offset,littleEndian),float32[0]},Stream.prototype.readFloat64=function(littleEndian){return this.read(8,littleEndian),float64?float64[0]:float64Fallback()},float64Fallback=function(){var exp,frac,high,low,out,sign;return low=uint32[0],(high=uint32[1])&&2147483648!==high?(sign=1-2*(high>>>31),exp=high>>>20&2047,frac=1048575&high,2047===exp?frac?NaN:Infinity*sign:(exp-=1023,out=(1048576|frac)*Math.pow(2,exp-20),out+=low*Math.pow(2,exp-52),sign*out)):0},Stream.prototype.peekFloat64=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(8,offset,littleEndian),float64?float64[0]:float64Fallback()},Stream.prototype.readFloat80=function(littleEndian){return this.read(10,littleEndian),float80()},float80=function(){var a0,a1,exp,high,low,out,sign;return high=uint32[0],low=uint32[1],a0=uint8[9],a1=uint8[8],sign=1-2*(a0>>>7),0===(exp=(127&a0)<<8|a1)&&0===low&&0===high?0:32767===exp?0===low&&0===high?Infinity*sign:NaN:(exp-=16383,out=low*Math.pow(2,exp-31),out+=high*Math.pow(2,exp-63),sign*out)},Stream.prototype.peekFloat80=function(offset,littleEndian){return null==offset&&(offset=0),this.peek(10,offset,littleEndian),float80()},Stream.prototype.readBuffer=function(length){var i,j,ref,result,to;for(result=AVBuffer.allocate(length),to=result.data,i=j=0,ref=length;j<ref;i=j+=1)to[i]=this.readUInt8();return result},Stream.prototype.peekBuffer=function(offset,length){var i,j,ref,result,to;for(null==offset&&(offset=0),result=AVBuffer.allocate(length),to=result.data,i=j=0,ref=length;j<ref;i=j+=1)to[i]=this.peekUInt8(offset+i);return result},Stream.prototype.readSingleBuffer=function(length){var result;return result=this.list.first.slice(this.localOffset,length),this.advance(result.length),result},Stream.prototype.peekSingleBuffer=function(offset,length){return this.list.first.slice(this.localOffset+offset,length)},Stream.prototype.readString=function(length,encoding){return null==encoding&&(encoding="ascii"),decodeString.call(this,0,length,encoding,!0)},Stream.prototype.peekString=function(offset,length,encoding){return null==offset&&(offset=0),null==encoding&&(encoding="ascii"),decodeString.call(this,offset,length,encoding,!1)},decodeString=function(offset,length,encoding,advance){var b1,b2,b3,b4,bom,c,end,littleEndian,nullEnd,pt,result,w1,w2;switch(encoding=encoding.toLowerCase(),nullEnd=null===length?0:-1,null==length&&(length=Infinity),end=offset+length,result="",encoding){case"ascii":case"latin1":for(;offset<end&&(c=this.peekUInt8(offset++))!==nullEnd;)result+=String.fromCharCode(c);break;case"utf8":case"utf-8":for(;offset<end&&(b1=this.peekUInt8(offset++))!==nullEnd;)0==(128&b1)?result+=String.fromCharCode(b1):192==(224&b1)?(b2=63&this.peekUInt8(offset++),result+=String.fromCharCode((31&b1)<<6|b2)):224==(240&b1)?(b2=63&this.peekUInt8(offset++),b3=63&this.peekUInt8(offset++),result+=String.fromCharCode((15&b1)<<12|b2<<6|b3)):240==(248&b1)&&(b2=63&this.peekUInt8(offset++),b3=63&this.peekUInt8(offset++),b4=63&this.peekUInt8(offset++),pt=((15&b1)<<18|b2<<12|b3<<6|b4)-65536,result+=String.fromCharCode(55296+(pt>>10),56320+(1023&pt)));break;case"utf16-be":case"utf16be":case"utf16le":case"utf16-le":case"utf16bom":case"utf16-bom":switch(encoding){case"utf16be":case"utf16-be":littleEndian=!1;break;case"utf16le":case"utf16-le":littleEndian=!0;break;case"utf16bom":case"utf16-bom":if(length<2||(bom=this.peekUInt16(offset))===nullEnd)return advance&&this.advance(offset+=2),result;littleEndian=65534===bom,offset+=2}for(;offset<end&&(w1=this.peekUInt16(offset,littleEndian))!==nullEnd;)if(offset+=2,w1<55296||w1>57343)result+=String.fromCharCode(w1);else{if(w1>56319)throw new Error("Invalid utf16 sequence.");if((w2=this.peekUInt16(offset,littleEndian))<56320||w2>57343)throw new Error("Invalid utf16 sequence.");result+=String.fromCharCode(w1,w2),offset+=2}w1===nullEnd&&(offset+=2);break;default:throw new Error("Unknown encoding: "+encoding)}return advance&&this.advance(offset),result},Stream}(),module.exports=Stream}).call(this)},{"./buffer":6,"./bufferlist":7,"./underflow":10}],10:[function(require,module,exports){(function(){var UnderflowError,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;UnderflowError=function(superClass){function UnderflowError(){UnderflowError.__super__.constructor.apply(this,arguments),this.name="UnderflowError",this.stack=(new Error).stack}return extend(UnderflowError,superClass),UnderflowError}(Error),module.exports=UnderflowError}).call(this)},{}],11:[function(require,module,exports){(function(){var Bitstream,BufferList,Decoder,EventEmitter,Stream,UnderflowError,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events"),BufferList=require("./core/bufferlist"),Stream=require("./core/stream"),Bitstream=require("./core/bitstream"),UnderflowError=require("./core/underflow"),Decoder=function(superClass){function Decoder(demuxer,format){var list;this.demuxer=demuxer,this.format=format,list=new BufferList,this.stream=new Stream(list),this.bitstream=new Bitstream(this.stream),this.receivedFinalBuffer=!1,this.waiting=!1,this.demuxer.on("cookie",function(_this){return function(cookie){var error;try{return _this.setCookie(cookie)}catch(error1){return error=error1,_this.emit("error",error)}}}(this)),this.demuxer.on("data",function(_this){return function(chunk){if(list.append(chunk),_this.waiting)return _this.decode()}}(this)),this.demuxer.on("end",function(_this){return function(){if(_this.receivedFinalBuffer=!0,_this.waiting)return _this.decode()}}(this)),this.init()}var codecs;return extend(Decoder,superClass),Decoder.prototype.init=function(){},Decoder.prototype.setCookie=function(cookie){},Decoder.prototype.readChunk=function(){},Decoder.prototype.decode=function(){var error,offset,packet;this.waiting=!this.receivedFinalBuffer,offset=this.bitstream.offset();try{packet=this.readChunk()}catch(error1){if(!((error=error1)instanceof UnderflowError))return this.emit("error",error),!1}return packet?(this.emit("data",packet),this.receivedFinalBuffer&&this.emit("end"),!0):(this.receivedFinalBuffer?this.emit("end"):(this.bitstream.seek(offset),this.waiting=!0),!1)},Decoder.prototype.seek=function(timestamp){var seekPoint;return seekPoint=this.demuxer.seek(timestamp),this.stream.seek(seekPoint.offset),seekPoint.timestamp},codecs={},Decoder.register=function(id,decoder){return codecs[id]=decoder},Decoder.find=function(id){return codecs[id]||null},Decoder}(EventEmitter),module.exports=Decoder}).call(this)},{"./core/bitstream":5,"./core/bufferlist":7,"./core/events":8,"./core/stream":9,"./core/underflow":10}],12:[function(require,module,exports){(function(){var Decoder,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Decoder=require("../decoder"),function(superClass){function LPCMDecoder(){return this.readChunk=bind(this.readChunk,this),LPCMDecoder.__super__.constructor.apply(this,arguments)}extend(LPCMDecoder,superClass),Decoder.register("lpcm",LPCMDecoder),LPCMDecoder.prototype.readChunk=function(){var chunkSize,i,j,k,l,littleEndian,m,n,o,output,ref,ref1,ref2,ref3,ref4,ref5,samples,stream;if(stream=this.stream,littleEndian=this.format.littleEndian,chunkSize=Math.min(4096,stream.remainingBytes()),samples=chunkSize/(this.format.bitsPerChannel/8)|0,chunkSize<this.format.bitsPerChannel/8)return null;if(this.format.floatingPoint)switch(this.format.bitsPerChannel){case 32:for(output=new Float32Array(samples),i=j=0,ref=samples;j<ref;i=j+=1)output[i]=stream.readFloat32(littleEndian);break;case 64:for(output=new Float64Array(samples),i=k=0,ref1=samples;k<ref1;i=k+=1)output[i]=stream.readFloat64(littleEndian);break;default:throw new Error("Unsupported bit depth.")}else switch(this.format.bitsPerChannel){case 8:for(output=new Int8Array(samples),i=l=0,ref2=samples;l<ref2;i=l+=1)output[i]=stream.readInt8();break;case 16:for(output=new Int16Array(samples),i=m=0,ref3=samples;m<ref3;i=m+=1)output[i]=stream.readInt16(littleEndian);break;case 24:for(output=new Int32Array(samples),i=n=0,ref4=samples;n<ref4;i=n+=1)output[i]=stream.readInt24(littleEndian);break;case 32:for(output=new Int32Array(samples),i=o=0,ref5=samples;o<ref5;i=o+=1)output[i]=stream.readInt32(littleEndian);break;default:throw new Error("Unsupported bit depth.")}return output}}(Decoder)}).call(this)},{"../decoder":11}],13:[function(require,module,exports){(function(){var Decoder,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Decoder=require("../decoder"),function(superClass){function XLAWDecoder(){return this.readChunk=bind(this.readChunk,this),
XLAWDecoder.__super__.constructor.apply(this,arguments)}var BIAS,QUANT_MASK,SEG_MASK,SEG_SHIFT,SIGN_BIT;extend(XLAWDecoder,superClass),Decoder.register("ulaw",XLAWDecoder),Decoder.register("alaw",XLAWDecoder),SIGN_BIT=128,QUANT_MASK=15,SEG_SHIFT=4,SEG_MASK=112,BIAS=132,XLAWDecoder.prototype.init=function(){var i,j,k,seg,t,table,val;if(this.format.bitsPerChannel=16,this.table=table=new Int16Array(256),"ulaw"===this.format.formatID)for(i=j=0;j<256;i=++j)val=~i,t=((val&QUANT_MASK)<<3)+BIAS,t<<=(val&SEG_MASK)>>>SEG_SHIFT,table[i]=val&SIGN_BIT?BIAS-t:t-BIAS;else for(i=k=0;k<256;i=++k)val=85^i,t=val&QUANT_MASK,seg=(val&SEG_MASK)>>>SEG_SHIFT,t=seg?t+t+1+32<<seg+2:t+t+1<<3,table[i]=val&SIGN_BIT?t:-t},XLAWDecoder.prototype.readChunk=function(){var i,j,output,ref,ref1,samples,stream,table;if(ref=this,stream=ref.stream,table=ref.table,0!==(samples=Math.min(4096,this.stream.remainingBytes()))){for(output=new Int16Array(samples),i=j=0,ref1=samples;j<ref1;i=j+=1)output[i]=table[stream.readUInt8()];return output}}}(Decoder)}).call(this)},{"../decoder":11}],14:[function(require,module,exports){(function(){var BufferList,Demuxer,EventEmitter,Stream,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events"),BufferList=require("./core/bufferlist"),Stream=require("./core/stream"),Demuxer=function(superClass){function Demuxer(source,chunk){var list,received;list=new BufferList,list.append(chunk),this.stream=new Stream(list),received=!1,source.on("data",function(_this){return function(chunk){var e;received=!0,list.append(chunk);try{return _this.readChunk(chunk)}catch(error){return e=error,_this.emit("error",e)}}}(this)),source.on("error",function(_this){return function(err){return _this.emit("error",err)}}(this)),source.on("end",function(_this){return function(){return received||_this.readChunk(chunk),_this.emit("end")}}(this)),this.seekPoints=[],this.init()}var formats;return extend(Demuxer,superClass),Demuxer.probe=function(buffer){return!1},Demuxer.prototype.init=function(){},Demuxer.prototype.readChunk=function(chunk){},Demuxer.prototype.addSeekPoint=function(offset,timestamp){var index;return index=this.searchTimestamp(timestamp),this.seekPoints.splice(index,0,{offset:offset,timestamp:timestamp})},Demuxer.prototype.searchTimestamp=function(timestamp,backward){var high,low,mid,time;if(low=0,(high=this.seekPoints.length)>0&&this.seekPoints[high-1].timestamp<timestamp)return high;for(;low<high;)mid=low+high>>1,time=this.seekPoints[mid].timestamp,time<timestamp?low=mid+1:time>=timestamp&&(high=mid);return high>this.seekPoints.length&&(high=this.seekPoints.length),high},Demuxer.prototype.seek=function(timestamp){var index;return this.format&&this.format.framesPerPacket>0&&this.format.bytesPerPacket>0?{timestamp:timestamp,offset:this.format.bytesPerPacket*timestamp/this.format.framesPerPacket}:(index=this.searchTimestamp(timestamp),this.seekPoints[index])},formats=[],Demuxer.register=function(demuxer){return formats.push(demuxer)},Demuxer.find=function(buffer){var format,i,len,offset,stream;for(stream=Stream.fromBuffer(buffer),i=0,len=formats.length;i<len;i++){format=formats[i],offset=stream.offset;try{if(format.probe(stream))return format}catch(error){error}stream.seek(offset)}return null},Demuxer}(EventEmitter),module.exports=Demuxer}).call(this)},{"./core/bufferlist":7,"./core/events":8,"./core/stream":9}],15:[function(require,module,exports){(function(){var Demuxer,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer"),function(superClass){function AIFFDemuxer(){return AIFFDemuxer.__super__.constructor.apply(this,arguments)}extend(AIFFDemuxer,superClass),Demuxer.register(AIFFDemuxer),AIFFDemuxer.probe=function(buffer){var ref;return"FORM"===buffer.peekString(0,4)&&("AIFF"===(ref=buffer.peekString(8,4))||"AIFC"===ref)},AIFFDemuxer.prototype.readChunk=function(){var buffer,format,offset,ref;if(!this.readStart&&this.stream.available(12)){if("FORM"!==this.stream.readString(4))return this.emit("error","Invalid AIFF.");if(this.fileSize=this.stream.readUInt32(),this.fileType=this.stream.readString(4),this.readStart=!0,"AIFF"!==(ref=this.fileType)&&"AIFC"!==ref)return this.emit("error","Invalid AIFF.")}for(;this.stream.available(1);){switch(!this.readHeaders&&this.stream.available(8)&&(this.type=this.stream.readString(4),this.len=this.stream.readUInt32()),this.type){case"COMM":if(!this.stream.available(this.len))return;this.format={formatID:"lpcm",channelsPerFrame:this.stream.readUInt16(),sampleCount:this.stream.readUInt32(),bitsPerChannel:this.stream.readUInt16(),sampleRate:this.stream.readFloat80(),framesPerPacket:1,littleEndian:!1,floatingPoint:!1},this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,"AIFC"===this.fileType&&(format=this.stream.readString(4),this.format.littleEndian="sowt"===format&&this.format.bitsPerChannel>8,this.format.floatingPoint="fl32"===format||"fl64"===format,"twos"!==format&&"sowt"!==format&&"fl32"!==format&&"fl64"!==format&&"NONE"!==format||(format="lpcm"),this.format.formatID=format,this.len-=4),this.stream.advance(this.len-18),this.emit("format",this.format),this.emit("duration",this.format.sampleCount/this.format.sampleRate*1e3|0);break;case"SSND":this.readSSNDHeader&&this.stream.available(4)||(offset=this.stream.readUInt32(),this.stream.advance(4),this.stream.advance(offset),this.readSSNDHeader=!0),buffer=this.stream.readSingleBuffer(this.len),this.len-=buffer.length,this.readHeaders=this.len>0,this.emit("data",buffer);break;default:if(!this.stream.available(this.len))return;this.stream.advance(this.len)}"SSND"!==this.type&&(this.readHeaders=!1)}}}(Demuxer)}).call(this)},{"../demuxer":14}],16:[function(require,module,exports){(function(){var Demuxer,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer"),function(superClass){function AUDemuxer(){return AUDemuxer.__super__.constructor.apply(this,arguments)}var bps,formats;extend(AUDemuxer,superClass),Demuxer.register(AUDemuxer),AUDemuxer.probe=function(buffer){return".snd"===buffer.peekString(0,4)},bps=[8,8,16,24,32,32,64],bps[26]=8,formats={1:"ulaw",27:"alaw"},AUDemuxer.prototype.readChunk=function(){var bytes,dataSize,encoding;if(!this.readHeader&&this.stream.available(24)){if(".snd"!==this.stream.readString(4))return this.emit("error","Invalid AU file.");if(this.stream.readUInt32(),dataSize=this.stream.readUInt32(),encoding=this.stream.readUInt32(),this.format={formatID:formats[encoding]||"lpcm",littleEndian:!1,floatingPoint:6===encoding||7===encoding,bitsPerChannel:bps[encoding-1],sampleRate:this.stream.readUInt32(),channelsPerFrame:this.stream.readUInt32(),framesPerPacket:1},null==this.format.bitsPerChannel)return this.emit("error","Unsupported encoding in AU file.");this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,4294967295!==dataSize&&(bytes=this.format.bitsPerChannel/8,this.emit("duration",dataSize/bytes/this.format.channelsPerFrame/this.format.sampleRate*1e3|0)),this.emit("format",this.format),this.readHeader=!0}if(this.readHeader)for(;this.stream.available(1);)this.emit("data",this.stream.readSingleBuffer(this.stream.remainingBytes()))}}(Demuxer)}).call(this)},{"../demuxer":14}],17:[function(require,module,exports){(function(){var Demuxer,M4ADemuxer,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer"),M4ADemuxer=require("./m4a"),function(superClass){function CAFDemuxer(){return CAFDemuxer.__super__.constructor.apply(this,arguments)}extend(CAFDemuxer,superClass),Demuxer.register(CAFDemuxer),CAFDemuxer.probe=function(buffer){return"caff"===buffer.peekString(0,4)},CAFDemuxer.prototype.readChunk=function(){var buffer,byteOffset,cookie,entries,flags,j,k,key,metadata,offset,ref,ref1,sampleOffset,value;if(!this.format&&this.stream.available(64)){if("caff"!==this.stream.readString(4))return this.emit("error","Invalid CAF, does not begin with 'caff'");if(this.stream.advance(4),"desc"!==this.stream.readString(4))return this.emit("error","Invalid CAF, 'caff' is not followed by 'desc'");if(0!==this.stream.readUInt32()||32!==this.stream.readUInt32())return this.emit("error","Invalid 'desc' size, should be 32");this.format={},this.format.sampleRate=this.stream.readFloat64(),this.format.formatID=this.stream.readString(4),flags=this.stream.readUInt32(),"lpcm"===this.format.formatID&&(this.format.floatingPoint=Boolean(1&flags),this.format.littleEndian=Boolean(2&flags)),this.format.bytesPerPacket=this.stream.readUInt32(),this.format.framesPerPacket=this.stream.readUInt32(),this.format.channelsPerFrame=this.stream.readUInt32(),this.format.bitsPerChannel=this.stream.readUInt32(),this.emit("format",this.format)}for(;this.stream.available(1);){if(!this.headerCache&&(this.headerCache={type:this.stream.readString(4),oversize:0!==this.stream.readUInt32(),size:this.stream.readUInt32()},this.headerCache.oversize))return this.emit("error","Holy Shit, an oversized file, not supported in JS");switch(this.headerCache.type){case"kuki":this.stream.available(this.headerCache.size)&&("aac "===this.format.formatID?(offset=this.stream.offset+this.headerCache.size,(cookie=M4ADemuxer.readEsds(this.stream))&&this.emit("cookie",cookie),this.stream.seek(offset)):(buffer=this.stream.readBuffer(this.headerCache.size),this.emit("cookie",buffer)),this.headerCache=null);break;case"pakt":if(this.stream.available(this.headerCache.size)){if(0!==this.stream.readUInt32())return this.emit("error","Sizes greater than 32 bits are not supported.");if(this.numPackets=this.stream.readUInt32(),0!==this.stream.readUInt32())return this.emit("error","Sizes greater than 32 bits are not supported.");for(this.numFrames=this.stream.readUInt32(),this.primingFrames=this.stream.readUInt32(),this.remainderFrames=this.stream.readUInt32(),this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0),this.sentDuration=!0,byteOffset=0,sampleOffset=0,j=0,ref=this.numPackets;j<ref;j+=1)this.addSeekPoint(byteOffset,sampleOffset),byteOffset+=this.format.bytesPerPacket||M4ADemuxer.readDescrLen(this.stream),sampleOffset+=this.format.framesPerPacket||M4ADemuxer.readDescrLen(this.stream);this.headerCache=null}break;case"info":for(entries=this.stream.readUInt32(),metadata={},k=0,ref1=entries;0<=ref1?k<ref1:k>ref1;0<=ref1?++k:--k)key=this.stream.readString(null),value=this.stream.readString(null),metadata[key]=value;this.emit("metadata",metadata),this.headerCache=null;break;case"data":this.sentFirstDataChunk||(this.stream.advance(4),this.headerCache.size-=4,0===this.format.bytesPerPacket||this.sentDuration||(this.numFrames=this.headerCache.size/this.format.bytesPerPacket,this.emit("duration",this.numFrames/this.format.sampleRate*1e3|0)),this.sentFirstDataChunk=!0),buffer=this.stream.readSingleBuffer(this.headerCache.size),this.headerCache.size-=buffer.length,this.emit("data",buffer),this.headerCache.size<=0&&(this.headerCache=null);break;default:this.stream.available(this.headerCache.size)&&(this.stream.advance(this.headerCache.size),this.headerCache=null)}}}}(Demuxer)}).call(this)},{"../demuxer":14,"./m4a":18}],18:[function(require,module,exports){(function(){var Demuxer,M4ADemuxer,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Demuxer=require("../demuxer"),M4ADemuxer=function(superClass){function M4ADemuxer(){return M4ADemuxer.__super__.constructor.apply(this,arguments)}var BITS_PER_CHANNEL,TYPES,after,atom,atoms,bool,containers,diskTrack,genres,meta,string;return extend(M4ADemuxer,superClass),Demuxer.register(M4ADemuxer),TYPES=["M4A ","M4P ","M4B ","M4V ","isom","mp42","qt  "],M4ADemuxer.probe=function(buffer){var ref;return"ftyp"===buffer.peekString(4,4)&&(ref=buffer.peekString(8,4),indexOf.call(TYPES,ref)>=0)},M4ADemuxer.prototype.init=function(){return this.atoms=[],this.offsets=[],this.track=null,this.tracks=[]},atoms={},containers={},atom=function(name,fn){var c,container,k,len1,ref;for(c=[],ref=name.split(".").slice(0,-1),k=0,len1=ref.length;k<len1;k++)container=ref[k],c.push(container),containers[c.join(".")]=!0;return null==atoms[name]&&(atoms[name]={}),atoms[name].fn=fn},after=function(name,fn){return null==atoms[name]&&(atoms[name]={}),atoms[name].after=fn},M4ADemuxer.prototype.readChunk=function(){var handler,path;for(this.break=!1;this.stream.available(1)&&!this.break;){if(!this.readHeaders){if(!this.stream.available(8))return;if(this.len=this.stream.readUInt32()-8,this.type=this.stream.readString(4),0===this.len)continue;this.atoms.push(this.type),this.offsets.push(this.stream.offset+this.len),this.readHeaders=!0}if(path=this.atoms.join("."),handler=atoms[path],null!=handler?handler.fn:void 0){if(!this.stream.available(this.len)&&"mdat"!==path)return;handler.fn.call(this),path in containers&&(this.readHeaders=!1)}else if(path in containers)this.readHeaders=!1;else{if(!this.stream.available(this.len))return;this.stream.advance(this.len)}for(;this.stream.offset>=this.offsets[this.offsets.length-1];)handler=atoms[this.atoms.join(".")],(null!=handler?handler.after:void 0)&&handler.after.call(this),this.atoms.pop(),this.offsets.pop(),this.readHeaders=!1}},atom("ftyp",function(){var ref;return ref=this.stream.readString(4),indexOf.call(TYPES,ref)<0?this.emit("error","Not a valid M4A file."):this.stream.advance(this.len-4)}),atom("moov.trak",function(){return this.track={},this.tracks.push(this.track)}),atom("moov.trak.tkhd",function(){return this.stream.advance(4),this.stream.advance(8),this.track.id=this.stream.readUInt32(),this.stream.advance(this.len-16)}),atom("moov.trak.mdia.hdlr",function(){return this.stream.advance(4),this.stream.advance(4),this.track.type=this.stream.readString(4),this.stream.advance(12),this.stream.advance(this.len-24)}),atom("moov.trak.mdia.mdhd",function(){return this.stream.advance(4),this.stream.advance(8),this.track.timeScale=this.stream.readUInt32(),this.track.duration=this.stream.readUInt32(),this.stream.advance(4)}),BITS_PER_CHANNEL={ulaw:8,alaw:8,in24:24,in32:32,fl32:32,fl64:64},atom("moov.trak.mdia.minf.stbl.stsd",function(){var format,numEntries,ref,ref1,version;return this.stream.advance(4),numEntries=this.stream.readUInt32(),"soun"!==this.track.type?this.stream.advance(this.len-8):1!==numEntries?this.emit("error","Only expecting one entry in sample description atom!"):(this.stream.advance(4),format=this.track.format={},format.formatID=this.stream.readString(4),this.stream.advance(6),this.stream.advance(2),version=this.stream.readUInt16(),this.stream.advance(6),format.channelsPerFrame=this.stream.readUInt16(),format.bitsPerChannel=this.stream.readUInt16(),this.stream.advance(4),format.sampleRate=this.stream.readUInt16(),this.stream.advance(2),1===version?(format.framesPerPacket=this.stream.readUInt32(),this.stream.advance(4),format.bytesPerFrame=this.stream.readUInt32(),this.stream.advance(4)):0!==version&&this.emit("error","Unknown version in stsd atom"),null!=BITS_PER_CHANNEL[format.formatID]&&(format.bitsPerChannel=BITS_PER_CHANNEL[format.formatID]),format.floatingPoint="fl32"===(ref=format.formatID)||"fl64"===ref,format.littleEndian="sowt"===format.formatID&&format.bitsPerChannel>8,"twos"===(ref1=format.formatID)||"sowt"===ref1||"in24"===ref1||"in32"===ref1||"fl32"===ref1||"fl64"===ref1||"raw "===ref1||"NONE"===ref1?format.formatID="lpcm":void 0)}),atom("moov.trak.mdia.minf.stbl.stsd.alac",function(){return this.stream.advance(4),this.track.cookie=this.stream.readBuffer(this.len-4)}),atom("moov.trak.mdia.minf.stbl.stsd.esds",function(){var offset;return offset=this.stream.offset+this.len,this.track.cookie=M4ADemuxer.readEsds(this.stream),this.stream.seek(offset)}),atom("moov.trak.mdia.minf.stbl.stsd.wave.enda",function(){return this.track.format.littleEndian=!!this.stream.readUInt16()}),M4ADemuxer.readDescrLen=function(stream){var c,count,len;for(len=0,count=4;count--&&(c=stream.readUInt8(),len=len<<7|127&c,128&c););return len},M4ADemuxer.readEsds=function(stream){var flags,len,tag;return stream.advance(4),tag=stream.readUInt8(),len=M4ADemuxer.readDescrLen(stream),3===tag?(stream.advance(2),flags=stream.readUInt8(),128&flags&&stream.advance(2),64&flags&&stream.advance(stream.readUInt8()),32&flags&&stream.advance(2)):stream.advance(2),tag=stream.readUInt8(),len=M4ADemuxer.readDescrLen(stream),4===tag&&(stream.readUInt8(),stream.advance(1),stream.advance(3),stream.advance(4),stream.advance(4),tag=stream.readUInt8(),len=M4ADemuxer.readDescrLen(stream),5===tag)?stream.readBuffer(len):null},atom("moov.trak.mdia.minf.stbl.stts",function(){var entries,i,k,ref;for(this.stream.advance(4),entries=this.stream.readUInt32(),this.track.stts=[],i=k=0,ref=entries;k<ref;i=k+=1)this.track.stts[i]={count:this.stream.readUInt32(),duration:this.stream.readUInt32()};return this.setupSeekPoints()}),atom("moov.trak.mdia.minf.stbl.stsc",function(){var entries,i,k,ref;for(this.stream.advance(4),entries=this.stream.readUInt32(),this.track.stsc=[],i=k=0,ref=entries;k<ref;i=k+=1)this.track.stsc[i]={first:this.stream.readUInt32(),count:this.stream.readUInt32(),id:this.stream.readUInt32()};return this.setupSeekPoints()}),atom("moov.trak.mdia.minf.stbl.stsz",function(){var entries,i,k,ref;if(this.stream.advance(4),this.track.sampleSize=this.stream.readUInt32(),entries=this.stream.readUInt32(),0===this.track.sampleSize&&entries>0)for(this.track.sampleSizes=[],i=k=0,ref=entries;k<ref;i=k+=1)this.track.sampleSizes[i]=this.stream.readUInt32();return this.setupSeekPoints()}),atom("moov.trak.mdia.minf.stbl.stco",function(){var entries,i,k,ref;for(this.stream.advance(4),entries=this.stream.readUInt32(),this.track.chunkOffsets=[],i=k=0,ref=entries;k<ref;i=k+=1)this.track.chunkOffsets[i]=this.stream.readUInt32();return this.setupSeekPoints()}),atom("moov.trak.tref.chap",function(){var entries,i,k,ref;for(entries=this.len>>2,this.track.chapterTracks=[],i=k=0,ref=entries;k<ref;i=k+=1)this.track.chapterTracks[i]=this.stream.readUInt32()}),M4ADemuxer.prototype.setupSeekPoints=function(){var i,k,l,len1,offset,position,ref,ref1,results,sampleIndex,size,stscIndex,sttsIndex,sttsSample,timestamp;if(null!=this.track.chunkOffsets&&null!=this.track.stsc&&null!=this.track.sampleSize&&null!=this.track.stts){for(stscIndex=0,sttsIndex=0,sttsIndex=0,sttsSample=0,sampleIndex=0,offset=0,timestamp=0,this.track.seekPoints=[],ref=this.track.chunkOffsets,results=[],i=k=0,len1=ref.length;k<len1;i=++k){for(position=ref[i],l=0,ref1=this.track.stsc[stscIndex].count;l<ref1;l+=1)this.track.seekPoints.push({offset:offset,position:position,timestamp:timestamp}),size=this.track.sampleSize||this.track.sampleSizes[sampleIndex++],offset+=size,position+=size,timestamp+=this.track.stts[sttsIndex].duration,sttsIndex+1<this.track.stts.length&&++sttsSample===this.track.stts[sttsIndex].count&&(sttsSample=0,sttsIndex++);stscIndex+1<this.track.stsc.length&&i+1===this.track.stsc[stscIndex+1].first?results.push(stscIndex++):results.push(void 0)}return results}},after("moov",function(){var k,len1,ref,track;for(null!=this.mdatOffset&&this.stream.seek(this.mdatOffset-8),ref=this.tracks,k=0,len1=ref.length;k<len1;k++)if(track=ref[k],"soun"===track.type){this.track=track;break}return"soun"!==this.track.type?(this.track=null,this.emit("error","No audio tracks in m4a file.")):(this.emit("format",this.track.format),this.emit("duration",this.track.duration/this.track.timeScale*1e3|0),this.track.cookie&&this.emit("cookie",this.track.cookie),this.seekPoints=this.track.seekPoints)}),atom("mdat",function(){var bytes,chunkSize,k,length,numSamples,offset,ref,sample,size;if(!this.startedData){if(null==this.mdatOffset&&(this.mdatOffset=this.stream.offset),0===this.tracks.length)return bytes=Math.min(this.stream.remainingBytes(),this.len),this.stream.advance(bytes),void(this.len-=bytes);this.chunkIndex=0,this.stscIndex=0,this.sampleIndex=0,this.tailOffset=0,this.tailSamples=0,this.startedData=!0}if(!this.readChapters){if(this.readChapters=this.parseChapters(),this.break=!this.readChapters)return;this.stream.seek(this.mdatOffset)}if(offset=this.track.chunkOffsets[this.chunkIndex]+this.tailOffset,length=0,!this.stream.available(offset-this.stream.offset))return void(this.break=!0);for(this.stream.seek(offset);this.chunkIndex<this.track.chunkOffsets.length;){for(numSamples=this.track.stsc[this.stscIndex].count-this.tailSamples,chunkSize=0,sample=k=0,ref=numSamples;k<ref&&(size=this.track.sampleSize||this.track.sampleSizes[this.sampleIndex],this.stream.available(length+size));sample=k+=1)length+=size,chunkSize+=size,this.sampleIndex++;if(sample<numSamples){this.tailOffset+=chunkSize,this.tailSamples+=sample;break}if(this.chunkIndex++,this.tailOffset=0,this.tailSamples=0,this.stscIndex+1<this.track.stsc.length&&this.chunkIndex+1===this.track.stsc[this.stscIndex+1].first&&this.stscIndex++,offset+length!==this.track.chunkOffsets[this.chunkIndex])break}return length>0?(this.emit("data",this.stream.readBuffer(length)),this.break=this.chunkIndex===this.track.chunkOffsets.length):this.break=!0}),M4ADemuxer.prototype.parseChapters=function(){var bom,id,k,len,len1,nextTimestamp,point,ref,ref1,ref2,ref3,title,track;if(!((null!=(ref=this.track.chapterTracks)?ref.length:void 0)>0))return!0;for(id=this.track.chapterTracks[0],ref1=this.tracks,k=0,len1=ref1.length;k<len1&&(track=ref1[k],track.id!==id);k++);for(track.id!==id&&this.emit("error","Chapter track does not exist."),null==this.chapters&&(this.chapters=[]);this.chapters.length<track.seekPoints.length;){if(point=track.seekPoints[this.chapters.length],!this.stream.available(point.position-this.stream.offset+32))return!1;if(this.stream.seek(point.position),len=this.stream.readUInt16(),title=null,!this.stream.available(len))return!1;len>2&&(65279!==(bom=this.stream.peekUInt16())&&65534!==bom||(title=this.stream.readString(len,"utf16-bom"))),null==title&&(title=this.stream.readString(len,"utf8")),nextTimestamp=null!=(ref2=null!=(ref3=track.seekPoints[this.chapters.length+1])?ref3.timestamp:void 0)?ref2:track.duration,this.chapters.push({title:title,timestamp:point.timestamp/track.timeScale*1e3|0,duration:(nextTimestamp-point.timestamp)/track.timeScale*1e3|0})}return this.emit("chapters",this.chapters),!0},atom("moov.udta.meta",function(){return this.metadata={},this.stream.advance(4)}),after("moov.udta.meta",function(){return this.emit("metadata",this.metadata)}),meta=function(field,name,fn){return atom("moov.udta.meta.ilst."+field+".data",function(){return this.stream.advance(8),this.len-=8,fn.call(this,name)})},string=function(field){return this.metadata[field]=this.stream.readString(this.len,"utf8")},meta("alb","album",string),meta("arg","arranger",string),meta("art","artist",string),meta("ART","artist",string),meta("aART","albumArtist",string),meta("catg","category",string),meta("com","composer",string),meta("cpy","copyright",string),meta("cprt","copyright",string),meta("cmt","comments",string),meta("day","releaseDate",string),meta("desc","description",string),meta("gen","genre",string),meta("grp","grouping",string),meta("isr","ISRC",string),meta("keyw","keywords",string),meta("lab","recordLabel",string),meta("ldes","longDescription",string),meta("lyr","lyrics",string),meta("nam","title",string),meta("phg","recordingCopyright",string),meta("prd","producer",string),meta("prf","performers",string),meta("purd","purchaseDate",string),meta("purl","podcastURL",string),meta("swf","songwriter",string),meta("too","encoder",string),meta("wrt","composer",string),meta("covr","coverArt",function(field){return this.metadata[field]=this.stream.readBuffer(this.len)}),genres=["Blues","Classic Rock","Country","Dance","Disco","Funk","Grunge","Hip-Hop","Jazz","Metal","New Age","Oldies","Other","Pop","R&B","Rap","Reggae","Rock","Techno","Industrial","Alternative","Ska","Death Metal","Pranks","Soundtrack","Euro-Techno","Ambient","Trip-Hop","Vocal","Jazz+Funk","Fusion","Trance","Classical","Instrumental","Acid","House","Game","Sound Clip","Gospel","Noise","AlternRock","Bass","Soul","Punk","Space","Meditative","Instrumental Pop","Instrumental Rock","Ethnic","Gothic","Darkwave","Techno-Industrial","Electronic","Pop-Folk","Eurodance","Dream","Southern Rock","Comedy","Cult","Gangsta","Top 40","Christian Rap","Pop/Funk","Jungle","Native American","Cabaret","New Wave","Psychadelic","Rave","Showtunes","Trailer","Lo-Fi","Tribal","Acid Punk","Acid Jazz","Polka","Retro","Musical","Rock & Roll","Hard Rock","Folk","Folk/Rock","National Folk","Swing","Fast Fusion","Bebob","Latin","Revival","Celtic","Bluegrass","Avantgarde","Gothic Rock","Progressive Rock","Psychedelic Rock","Symphonic Rock","Slow Rock","Big Band","Chorus","Easy Listening","Acoustic","Humour","Speech","Chanson","Opera","Chamber Music","Sonata","Symphony","Booty Bass","Primus","Porn Groove","Satire","Slow Jam","Club","Tango","Samba","Folklore","Ballad","Power Ballad","Rhythmic Soul","Freestyle","Duet","Punk Rock","Drum Solo","A Capella","Euro-House","Dance Hall"],meta("gnre","genre",function(field){return this.metadata[field]=genres[this.stream.readUInt16()-1]}),meta("tmpo","tempo",function(field){return this.metadata[field]=this.stream.readUInt16()}),meta("rtng","rating",function(field){var rating;return rating=this.stream.readUInt8(),this.metadata[field]=2===rating?"Clean":0!==rating?"Explicit":"None"}),diskTrack=function(field){return this.stream.advance(2),this.metadata[field]=this.stream.readUInt16()+" of "+this.stream.readUInt16(),this.stream.advance(this.len-6)},meta("disk","diskNumber",diskTrack),meta("trkn","trackNumber",diskTrack),bool=function(field){return this.metadata[field]=1===this.stream.readUInt8()},meta("cpil","compilation",bool),meta("pcst","podcast",bool),meta("pgap","gapless",bool),M4ADemuxer}(Demuxer),module.exports=M4ADemuxer}).call(this)},{"../demuxer":14}],19:[function(require,module,exports){(function(){var Demuxer,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Demuxer=require("../demuxer"),function(superClass){function WAVEDemuxer(){return WAVEDemuxer.__super__.constructor.apply(this,arguments)}var formats;extend(WAVEDemuxer,superClass),Demuxer.register(WAVEDemuxer),WAVEDemuxer.probe=function(buffer){return"RIFF"===buffer.peekString(0,4)&&"WAVE"===buffer.peekString(8,4)},formats={1:"lpcm",3:"lpcm",6:"alaw",7:"ulaw"},WAVEDemuxer.prototype.readChunk=function(){var buffer,bytes,encoding;if(!this.readStart&&this.stream.available(12)){if("RIFF"!==this.stream.readString(4))return this.emit("error","Invalid WAV file.");if(this.fileSize=this.stream.readUInt32(!0),this.readStart=!0,"WAVE"!==this.stream.readString(4))return this.emit("error","Invalid WAV file.")}for(;this.stream.available(1);){switch(!this.readHeaders&&this.stream.available(8)&&(this.type=this.stream.readString(4),this.len=this.stream.readUInt32(!0)),this.type){case"fmt ":if(!((encoding=this.stream.readUInt16(!0))in formats))return this.emit("error","Unsupported format in WAV file.");this.format={formatID:formats[encoding],floatingPoint:3===encoding,littleEndian:"lpcm"===formats[encoding],channelsPerFrame:this.stream.readUInt16(!0),sampleRate:this.stream.readUInt32(!0),framesPerPacket:1},this.stream.advance(4),this.stream.advance(2),this.format.bitsPerChannel=this.stream.readUInt16(!0),this.format.bytesPerPacket=this.format.bitsPerChannel/8*this.format.channelsPerFrame,this.emit("format",this.format),this.stream.advance(this.len-16);break;case"data":this.sentDuration||(bytes=this.format.bitsPerChannel/8,this.emit("duration",this.len/bytes/this.format.channelsPerFrame/this.format.sampleRate*1e3|0),this.sentDuration=!0),buffer=this.stream.readSingleBuffer(this.len),this.len-=buffer.length,this.readHeaders=this.len>0,this.emit("data",buffer);break;default:if(!this.stream.available(this.len))return;this.stream.advance(this.len)}"data"!==this.type&&(this.readHeaders=!1)}}}(Demuxer)}).call(this)},{"../demuxer":14}],20:[function(require,module,exports){(function(){var AudioDevice,EventEmitter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events"),AudioDevice=function(superClass){function AudioDevice(sampleRate1,channels1){this.sampleRate=sampleRate1,this.channels=channels1,this.updateTime=bind(this.updateTime,this),this.playing=!1,this.currentTime=0,this._lastTime=0}var devices;return extend(AudioDevice,superClass),AudioDevice.prototype.start=function(){if(!this.playing){if(this.playing=!0,null==this.device&&(this.device=AudioDevice.create(this.sampleRate,this.channels)),!this.device)throw new Error("No supported audio device found.");return this._lastTime=this.device.getDeviceTime(),this._timer=setInterval(this.updateTime,200),this.device.on("refill",this.refill=function(_this){return function(buffer){return _this.emit("refill",buffer)}}(this))}},AudioDevice.prototype.stop=function(){if(this.playing)return this.playing=!1,this.device.off("refill",this.refill),clearInterval(this._timer)},AudioDevice.prototype.destroy=function(){var ref;return this.stop(),null!=(ref=this.device)?ref.destroy():void 0},AudioDevice.prototype.seek=function(currentTime){return this.currentTime=currentTime,this.playing&&(this._lastTime=this.device.getDeviceTime()),this.emit("timeUpdate",this.currentTime)},AudioDevice.prototype.updateTime=function(){var time;return time=this.device.getDeviceTime(),this.currentTime+=(time-this._lastTime)/this.device.sampleRate*1e3|0,this._lastTime=time,this.emit("timeUpdate",this.currentTime)},devices=[],AudioDevice.register=function(device){return devices.push(device)},AudioDevice.create=function(sampleRate,channels){var device,i,len;for(i=0,len=devices.length;i<len;i++)if(device=devices[i],device.supported)return new device(sampleRate,channels);return null},AudioDevice}(EventEmitter),module.exports=AudioDevice}).call(this)},{"./core/events":8}],21:[function(require,module,exports){(function(){var AVBuffer,AudioDevice,EventEmitter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("../core/events"),AudioDevice=require("../device"),AVBuffer=require("../core/buffer"),function(superClass){function MozillaAudioDevice(sampleRate,channels){
this.sampleRate=sampleRate,this.channels=channels,this.refill=bind(this.refill,this),this.audio=new Audio,this.audio.mozSetup(this.channels,this.sampleRate),this.writePosition=0,this.prebufferSize=this.sampleRate/2,this.tail=null,this.timer=createTimer(this.refill,100)}var createTimer,destroyTimer;extend(MozillaAudioDevice,superClass),AudioDevice.register(MozillaAudioDevice),MozillaAudioDevice.supported="undefined"!=typeof Audio&&null!==Audio&&"mozWriteAudio"in new Audio,MozillaAudioDevice.prototype.refill=function(){var available,buffer,currentPosition,written;this.tail&&(written=this.audio.mozWriteAudio(this.tail),this.writePosition+=written,this.writePosition<this.tail.length?this.tail=this.tail.subarray(written):this.tail=null),currentPosition=this.audio.mozCurrentSampleOffset(),(available=currentPosition+this.prebufferSize-this.writePosition)>0&&(buffer=new Float32Array(available),this.emit("refill",buffer),written=this.audio.mozWriteAudio(buffer),written<buffer.length&&(this.tail=buffer.subarray(written)),this.writePosition+=written)},MozillaAudioDevice.prototype.destroy=function(){return destroyTimer(this.timer)},MozillaAudioDevice.prototype.getDeviceTime=function(){return this.audio.mozCurrentSampleOffset()/this.channels},createTimer=function(fn,interval){var url,worker;return null==(url=AVBuffer.makeBlobURL("setInterval(function() { postMessage('ping'); }, "+interval+");"))?setInterval(fn,interval):(worker=new Worker(url),worker.onmessage=fn,worker.url=url,worker)},destroyTimer=function(timer){return timer.terminate?(timer.terminate(),URL.revokeObjectURL(timer.url)):clearInterval(timer)}}(EventEmitter)}).call(this)},{"../core/buffer":6,"../core/events":8,"../device":20}],22:[function(require,module,exports){function Resampler(fromSampleRate,toSampleRate,channels,inputBufferLength){this.fromSampleRate=+fromSampleRate,this.toSampleRate=+toSampleRate,this.channels=0|channels,this.inputBufferLength=inputBufferLength,this.initialize()}Resampler.prototype.initialize=function(){if(!(this.fromSampleRate>0&&this.toSampleRate>0&&this.channels>0))throw new Error("Invalid settings specified for the resampler.");if(this.fromSampleRate==this.toSampleRate)this.resampler=this.bypassResampler,this.ratioWeight=1;else{this.ratioWeight=this.fromSampleRate/this.toSampleRate,this.fromSampleRate<this.toSampleRate?(this.compileLinearInterpolationFunction(),this.lastWeight=1):(this.compileMultiTapFunction(),this.tailExists=!1,this.lastWeight=0);var outputBufferSize=Math.ceil(this.inputBufferLength*this.toSampleRate/this.fromSampleRate/this.channels*1.01)*this.channels+this.channels;this.outputBuffer=new Float32Array(outputBufferSize),this.lastOutput=new Float32Array(this.channels)}},Resampler.prototype.compileLinearInterpolationFunction=function(){for(var toCompile="var outputOffset = 0;    var bufferLength = buffer.length;    if (bufferLength > 0) {      var weight = this.lastWeight;      var firstWeight = 0;      var secondWeight = 0;      var sourceOffset = 0;      var outputOffset = 0;      var outputBuffer = this.outputBuffer;      for (; weight < 1; weight += "+this.ratioWeight+") {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;",channel=0;channel<this.channels;++channel)toCompile+="outputBuffer[outputOffset++] = (this.lastOutput["+channel+"] * firstWeight) + (buffer["+channel+"] * secondWeight);";toCompile+="}      weight -= 1;      for (bufferLength -= "+this.channels+", sourceOffset = Math.floor(weight) * "+this.channels+"; sourceOffset < bufferLength;) {        secondWeight = weight % 1;        firstWeight = 1 - secondWeight;";for(var channel=0;channel<this.channels;++channel)toCompile+="outputBuffer[outputOffset++] = (buffer[sourceOffset"+(channel>0?" + "+channel:"")+"] * firstWeight) + (buffer[sourceOffset + "+(this.channels+channel)+"] * secondWeight);";toCompile+="weight += "+this.ratioWeight+";        sourceOffset = Math.floor(weight) * "+this.channels+";      }";for(var channel=0;channel<this.channels;++channel)toCompile+="this.lastOutput["+channel+"] = buffer[sourceOffset++];";toCompile+="this.lastWeight = weight % 1;    }    return this.outputBuffer;",this.resampler=Function("buffer",toCompile)},Resampler.prototype.compileMultiTapFunction=function(){for(var toCompile="var outputOffset = 0;    var bufferLength = buffer.length;    if (bufferLength > 0) {      var weight = 0;",channel=0;channel<this.channels;++channel)toCompile+="var output"+channel+" = 0;";for(toCompile+="var actualPosition = 0;      var amountToNext = 0;      var alreadyProcessedTail = !this.tailExists;      this.tailExists = false;      var outputBuffer = this.outputBuffer;      var currentPosition = 0;      do {        if (alreadyProcessedTail) {          weight = "+this.ratioWeight+";",channel=0;channel<this.channels;++channel)toCompile+="output"+channel+" = 0;";for(toCompile+="}        else {          weight = this.lastWeight;",channel=0;channel<this.channels;++channel)toCompile+="output"+channel+" = this.lastOutput["+channel+"];";for(toCompile+="alreadyProcessedTail = true;        }        while (weight > 0 && actualPosition < bufferLength) {          amountToNext = 1 + actualPosition - currentPosition;          if (weight >= amountToNext) {",channel=0;channel<this.channels;++channel)toCompile+="output"+channel+" += buffer[actualPosition++] * amountToNext;";for(toCompile+="currentPosition = actualPosition;            weight -= amountToNext;          }          else {",channel=0;channel<this.channels;++channel)toCompile+="output"+channel+" += buffer[actualPosition"+(channel>0?" + "+channel:"")+"] * weight;";for(toCompile+="currentPosition += weight;            weight = 0;            break;          }        }        if (weight <= 0) {",channel=0;channel<this.channels;++channel)toCompile+="outputBuffer[outputOffset++] = output"+channel+" / "+this.ratioWeight+";";for(toCompile+="}        else {          this.lastWeight = weight;",channel=0;channel<this.channels;++channel)toCompile+="this.lastOutput["+channel+"] = output"+channel+";";toCompile+="this.tailExists = true;          break;        }      } while (actualPosition < bufferLength);    }    return this.outputBuffer;",this.resampler=Function("buffer",toCompile)},Resampler.prototype.bypassResampler=function(inputBuffer){return inputBuffer},module.exports=Resampler},{}],23:[function(require,module,exports){(function(global){(function(){var AudioDevice,EventEmitter,Resampler,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("../core/events"),AudioDevice=require("../device"),Resampler=require("./resampler"),function(superClass){function WebAudioDevice(sampleRate,channels1){this.sampleRate=sampleRate,this.channels=channels1,this.refill=bind(this.refill,this),this.context=null!=sharedContext?sharedContext:sharedContext=new AudioContext,this.deviceSampleRate=this.context.sampleRate,this.bufferSize=Math.ceil(4096/(this.deviceSampleRate/this.sampleRate)*this.channels),this.bufferSize+=this.bufferSize%this.channels,this.deviceSampleRate!==this.sampleRate&&(this.resampler=new Resampler(this.sampleRate,this.deviceSampleRate,this.channels,this.bufferSize)),this.node=this.context[createProcessor](4096,this.channels,this.channels),this.node.onaudioprocess=this.refill,this.node.connect(this.context.destination)}var AudioContext,createProcessor,sharedContext;extend(WebAudioDevice,superClass),AudioDevice.register(WebAudioDevice),AudioContext=global.AudioContext||global.webkitAudioContext,WebAudioDevice.supported=AudioContext&&("function"==typeof AudioContext.prototype[createProcessor="createScriptProcessor"]||"function"==typeof AudioContext.prototype[createProcessor="createJavaScriptNode"]),sharedContext=null,WebAudioDevice.prototype.refill=function(event){var channelCount,channels,data,i,j,k,l,n,outputBuffer,ref,ref1,ref2;for(outputBuffer=event.outputBuffer,channelCount=outputBuffer.numberOfChannels,channels=new Array(channelCount),i=j=0,ref=channelCount;j<ref;i=j+=1)channels[i]=outputBuffer.getChannelData(i);for(data=new Float32Array(this.bufferSize),this.emit("refill",data),this.resampler&&(data=this.resampler.resampler(data)),i=k=0,ref1=outputBuffer.length;k<ref1;i=k+=1)for(n=l=0,ref2=channelCount;l<ref2;n=l+=1)channels[n][i]=data[i*channelCount+n]},WebAudioDevice.prototype.destroy=function(){return this.node.disconnect(0)},WebAudioDevice.prototype.getDeviceTime=function(){return this.context.currentTime*this.sampleRate}}(EventEmitter)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../core/events":8,"../device":20,"./resampler":22}],24:[function(require,module,exports){(function(){var Filter;Filter=function(){function Filter(context,key){context&&key&&Object.defineProperty(this,"value",{get:function(){return context[key]}})}return Filter.prototype.process=function(buffer){},Filter}(),module.exports=Filter}).call(this)},{}],25:[function(require,module,exports){(function(){var BalanceFilter,Filter,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Filter=require("../filter"),BalanceFilter=function(superClass){function BalanceFilter(){return BalanceFilter.__super__.constructor.apply(this,arguments)}return extend(BalanceFilter,superClass),BalanceFilter.prototype.process=function(buffer){var i,j,pan,ref;if(0!==this.value)for(pan=Math.max(-50,Math.min(50,this.value)),i=j=0,ref=buffer.length;j<ref;i=j+=2)buffer[i]*=Math.min(1,(50-pan)/50),buffer[i+1]*=Math.min(1,(50+pan)/50)},BalanceFilter}(Filter),module.exports=BalanceFilter}).call(this)},{"../filter":24}],26:[function(require,module,exports){(function(){var Filter,VolumeFilter,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Filter=require("../filter"),VolumeFilter=function(superClass){function VolumeFilter(){return VolumeFilter.__super__.constructor.apply(this,arguments)}return extend(VolumeFilter,superClass),VolumeFilter.prototype.process=function(buffer){var i,j,ref,vol;if(!(this.value>=100))for(vol=Math.max(0,Math.min(100,this.value))/100,i=j=0,ref=buffer.length;j<ref;i=j+=1)buffer[i]*=vol},VolumeFilter}(Filter),module.exports=VolumeFilter}).call(this)},{"../filter":24}],27:[function(require,module,exports){(function(){var Asset,AudioDevice,BalanceFilter,EventEmitter,Player,Queue,VolumeFilter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events"),Asset=require("./asset"),VolumeFilter=require("./filters/volume"),BalanceFilter=require("./filters/balance"),Queue=require("./queue"),AudioDevice=require("./device"),Player=function(superClass){function Player(asset){this.asset=asset,this.startPlaying=bind(this.startPlaying,this),this.playing=!1,this.buffered=0,this.currentTime=0,this.duration=0,this.volume=100,this.pan=0,this.metadata={},this.filters=[new VolumeFilter(this,"volume"),new BalanceFilter(this,"pan")],this.asset.on("buffer",function(_this){return function(buffered){return _this.buffered=buffered,_this.emit("buffer",_this.buffered)}}(this)),this.asset.on("decodeStart",function(_this){return function(){return _this.queue=new Queue(_this.asset),_this.queue.once("ready",_this.startPlaying)}}(this)),this.asset.on("format",function(_this){return function(format){return _this.format=format,_this.emit("format",_this.format)}}(this)),this.asset.on("metadata",function(_this){return function(metadata){return _this.metadata=metadata,_this.emit("metadata",_this.metadata)}}(this)),this.asset.on("duration",function(_this){return function(duration){return _this.duration=duration,_this.emit("duration",_this.duration)}}(this)),this.asset.on("error",function(_this){return function(error){return _this.emit("error",error)}}(this))}return extend(Player,superClass),Player.fromURL=function(url,opts){return new Player(Asset.fromURL(url,opts))},Player.fromFile=function(file){return new Player(Asset.fromFile(file))},Player.fromBuffer=function(buffer){return new Player(Asset.fromBuffer(buffer))},Player.prototype.preload=function(){if(this.asset)return this.startedPreloading=!0,this.asset.start(!1)},Player.prototype.play=function(){var ref;if(!this.playing)return this.startedPreloading||this.preload(),this.playing=!0,null!=(ref=this.device)?ref.start():void 0},Player.prototype.pause=function(){var ref;if(this.playing)return this.playing=!1,null!=(ref=this.device)?ref.stop():void 0},Player.prototype.togglePlayback=function(){return this.playing?this.pause():this.play()},Player.prototype.stop=function(){var ref;return this.pause(),this.asset.stop(),null!=(ref=this.device)?ref.destroy():void 0},Player.prototype.seek=function(timestamp){var ref;return null!=(ref=this.device)&&ref.stop(),this.queue.once("ready",function(_this){return function(){var ref1,ref2;if(null!=(ref1=_this.device)&&ref1.seek(_this.currentTime),_this.playing)return null!=(ref2=_this.device)?ref2.start():void 0}}(this)),timestamp=timestamp/1e3*this.format.sampleRate,timestamp=this.asset.decoder.seek(timestamp),this.currentTime=timestamp/this.format.sampleRate*1e3|0,this.queue.reset(),this.currentTime},Player.prototype.startPlaying=function(){var frame,frameOffset;return frame=this.queue.read(),frameOffset=0,this.device=new AudioDevice(this.format.sampleRate,this.format.channelsPerFrame),this.device.on("timeUpdate",function(_this){return function(currentTime){return _this.currentTime=currentTime,_this.emit("progress",_this.currentTime)}}(this)),this.refill=function(_this){return function(buffer){var bufferOffset,filter,j,k,len,max,ref,ref1;if(_this.playing){for(frame||(frame=_this.queue.read(),frameOffset=0),bufferOffset=0;frame&&bufferOffset<buffer.length;){for(max=Math.min(frame.length-frameOffset,buffer.length-bufferOffset),j=0,ref=max;j<ref;j+=1)buffer[bufferOffset++]=frame[frameOffset++];frameOffset===frame.length&&(frame=_this.queue.read(),frameOffset=0)}for(ref1=_this.filters,k=0,len=ref1.length;k<len;k++)filter=ref1[k],filter.process(buffer);frame||(_this.queue.ended?(_this.currentTime=_this.duration,_this.emit("progress",_this.currentTime),_this.emit("end"),_this.stop()):_this.device.stop())}}}(this),this.device.on("refill",this.refill),this.playing&&this.device.start(),this.emit("ready")},Player.prototype.destroy=function(){var ref,ref1;return this.stop(),null!=(ref=this.device)&&ref.off(),null!=(ref1=this.asset)&&ref1.destroy(),this.off()},Player}(EventEmitter),module.exports=Player}).call(this)},{"./asset":1,"./core/events":8,"./device":20,"./filters/balance":25,"./filters/volume":26,"./queue":28}],28:[function(require,module,exports){(function(){var EventEmitter,Queue,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("./core/events"),Queue=function(superClass){function Queue(asset){this.asset=asset,this.write=bind(this.write,this),this.readyMark=64,this.finished=!1,this.buffering=!0,this.ended=!1,this.buffers=[],this.asset.on("data",this.write),this.asset.on("end",function(_this){return function(){return _this.ended=!0}}(this)),this.asset.decodePacket()}return extend(Queue,superClass),Queue.prototype.write=function(buffer){if(buffer&&this.buffers.push(buffer),this.buffering)return this.buffers.length>=this.readyMark||this.ended?(this.buffering=!1,this.emit("ready")):this.asset.decodePacket()},Queue.prototype.read=function(){return 0===this.buffers.length?null:(this.asset.decodePacket(),this.buffers.shift())},Queue.prototype.reset=function(){return this.buffers.length=0,this.buffering=!0,this.asset.decodePacket()},Queue}(EventEmitter),module.exports=Queue}).call(this)},{"./core/events":8}],29:[function(require,module,exports){var AVBuffer,EventEmitter,FileSource,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};EventEmitter=require("../../core/events"),AVBuffer=require("../../core/buffer"),FileSource=function(_super){function FileSource(file){if(this.file=file,"undefined"==typeof FileReader||null===FileReader)return this.emit("error","This browser does not have FileReader support.");this.offset=0,this.length=this.file.size,this.chunkSize=1<<20,this.file[this.slice="slice"]||this.file[this.slice="webkitSlice"]||this.file[this.slice="mozSlice"]}return __extends(FileSource,_super),FileSource.prototype.start=function(){return this.reader&&!this.active?this.loop():(this.reader=new FileReader,this.active=!0,this.reader.onload=function(_this){return function(e){var buf;if(buf=new AVBuffer(new Uint8Array(e.target.result)),_this.offset+=buf.length,_this.emit("data",buf),_this.active=!1,_this.offset<_this.length)return _this.loop()}}(this),this.reader.onloadend=function(_this){return function(){if(_this.offset===_this.length)return _this.emit("end"),_this.reader=null}}(this),this.reader.onerror=function(_this){return function(e){return _this.emit("error",e)}}(this),this.reader.onprogress=function(_this){return function(e){return _this.emit("progress",(_this.offset+e.loaded)/_this.length*100)}}(this),this.loop())},FileSource.prototype.loop=function(){var blob,endPos;return this.active=!0,endPos=Math.min(this.offset+this.chunkSize,this.length),blob=this.file[this.slice](this.offset,endPos),this.reader.readAsArrayBuffer(blob)},FileSource.prototype.pause=function(){var _ref;this.active=!1;try{return null!=(_ref=this.reader)?_ref.abort():void 0}catch(_error){}},FileSource.prototype.reset=function(){return this.pause(),this.offset=0},FileSource}(EventEmitter),module.exports=FileSource},{"../../core/buffer":6,"../../core/events":8}],30:[function(require,module,exports){var AVBuffer,EventEmitter,HTTPSource,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};EventEmitter=require("../../core/events"),AVBuffer=require("../../core/buffer"),HTTPSource=function(_super){function HTTPSource(url,opts){this.url=url,this.opts=null!=opts?opts:{},this.chunkSize=1<<20,this.inflight=!1,this.opts.length&&(this.length=this.opts.length),this.reset()}return __extends(HTTPSource,_super),HTTPSource.prototype.start=function(){return this.length&&!this.inflight?this.loop():(this.inflight=!0,this.xhr=new XMLHttpRequest,this.xhr.onload=function(_this){return function(event){return _this.length=parseInt(_this.xhr.getResponseHeader("Content-Length")),_this.inflight=!1,_this.loop()}}(this),this.xhr.onerror=function(_this){return function(err){return _this.pause(),_this.emit("error",err)}}(this),this.xhr.onabort=function(_this){return function(event){return _this.inflight=!1}}(this),this.xhr.open("HEAD",this.url,!0),this.xhr.send(null))},HTTPSource.prototype.loop=function(){var endPos;return this.inflight||!this.length?this.emit("error","Something is wrong in HTTPSource.loop"):(this.inflight=!0,this.xhr=new XMLHttpRequest,this.xhr.onload=function(_this){return function(event){var buf,buffer,i,txt,_i,_ref;if(_this.xhr.response)buf=new Uint8Array(_this.xhr.response);else for(txt=_this.xhr.responseText,buf=new Uint8Array(txt.length),i=_i=0,_ref=txt.length;0<=_ref?_i<_ref:_i>_ref;i=0<=_ref?++_i:--_i)buf[i]=255&txt.charCodeAt(i);if(buffer=new AVBuffer(buf),_this.offset+=buffer.length,_this.emit("data",buffer),_this.offset>=_this.length&&_this.emit("end"),_this.inflight=!1,!(_this.offset>=_this.length))return _this.loop()}}(this),this.xhr.onprogress=function(_this){return function(event){return _this.emit("progress",(_this.offset+event.loaded)/_this.length*100)}}(this),this.xhr.onerror=function(_this){return function(err){return _this.emit("error",err),_this.pause()}}(this),this.xhr.onabort=function(_this){return function(event){return _this.inflight=!1}}(this),this.xhr.open("GET",this.url,!0),this.xhr.responseType="arraybuffer",endPos=Math.min(this.offset+this.chunkSize,this.length-1),this.xhr.setRequestHeader("If-None-Match","webkit-no-cache"),this.xhr.setRequestHeader("Range","bytes="+this.offset+"-"+endPos),this.xhr.overrideMimeType("text/plain; charset=x-user-defined"),this.xhr.send(null))},HTTPSource.prototype.pause=function(){var _ref;return this.inflight=!1,null!=(_ref=this.xhr)?_ref.abort():void 0},HTTPSource.prototype.reset=function(){return this.pause(),this.offset=0},HTTPSource}(EventEmitter),module.exports=HTTPSource},{"../../core/buffer":6,"../../core/events":8}],31:[function(require,module,exports){(function(global){(function(){var AVBuffer,BufferList,BufferSource,EventEmitter,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;EventEmitter=require("../core/events"),BufferList=require("../core/bufferlist"),AVBuffer=require("../core/buffer"),BufferSource=function(superClass){function BufferSource(input){this.loop=bind(this.loop,this),input instanceof BufferList?this.list=input:(this.list=new BufferList,this.list.append(new AVBuffer(input))),this.paused=!0}var clearImmediate,setImmediate;return extend(BufferSource,superClass),setImmediate=global.setImmediate||function(fn){return global.setTimeout(fn,0)},clearImmediate=global.clearImmediate||function(timer){return global.clearTimeout(timer)},BufferSource.prototype.start=function(){return this.paused=!1,this._timer=setImmediate(this.loop)},BufferSource.prototype.loop=function(){return this.emit("progress",(this.list.numBuffers-this.list.availableBuffers+1)/this.list.numBuffers*100|0),this.emit("data",this.list.first),this.list.advance()?setImmediate(this.loop):this.emit("end")},BufferSource.prototype.pause=function(){return clearImmediate(this._timer),this.paused=!0},BufferSource.prototype.reset=function(){return this.pause(),this.list.rewind()},BufferSource}(EventEmitter),module.exports=BufferSource}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../core/buffer":6,"../core/bufferlist":7,"../core/events":8}],32:[function(require,module,exports){var key,val,_ref;_ref=require("./src/aurora");for(key in _ref)val=_ref[key],exports[key]=val;require("./src/devices/webaudio"),require("./src/devices/mozilla")},{"./src/aurora":2,"./src/devices/mozilla":21,"./src/devices/webaudio":23}]},{},[32])(32)});